<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Pastrami</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        .tabs {
            display: flex;
            background: #f8f9fa;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            font-weight: bold;
        }
        .tab.active {
            background: white;
            color: #ff6b6b;
        }
        .content {
            display: none;
            padding: 20px;
        }
        .content.active {
            display: block;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-col {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary { background: #ff6b6b; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .item {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ff6b6b;
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .required { color: red; }
        .no-items {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•™ Sistema Pastrami</h1>
            <p>Gesti√≥n simple y efectiva</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="mostrarTab('clientes')">üë• Clientes</button>
            <button class="tab" onclick="mostrarTab('productos')">üì¶ Productos</button>
            <button class="tab" onclick="mostrarTab('pedidos')">üìã Pedidos</button>
            <button class="tab" onclick="mostrarTab('pagos')">üí∞ Pagos</button>
        </div>

        <!-- CLIENTES -->
        <div id="clientes" class="content active">
            <h2>üë• Gesti√≥n de Clientes</h2>
            
            <form onsubmit="guardarCliente(event)">
                <div class="form-row">
                    <div class="form-col">
                        <label>Nombre <span class="required">*</span>:</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div class="form-col">
                        <label>Apellido <span class="required">*</span>:</label>
                        <input type="text" id="apellido" required>
                    </div>
                    <div class="form-col">
                        <label>Tel√©fono <span class="required">*</span>:</label>
                        <input type="tel" id="telefono" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label>Calle:</label>
                        <input type="text" id="calle">
                    </div>
                    <div class="form-col">
                        <label>N√∫mero:</label>
                        <input type="text" id="numero">
                    </div>
                    <div class="form-col">
                        <label>Piso/Depto:</label>
                        <input type="text" id="piso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label>C√≥digo Postal:</label>
                        <input type="text" id="codigoPostal">
                    </div>
                    <div class="form-col">
                        <label>Localidad:</label>
                        <input type="text" id="localidad">
                    </div>
                    <div class="form-col">
                        <label>Email:</label>
                        <input type="email" id="email">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Cliente</button>
            </form>

            <div id="lista-clientes"></div>
        </div>

        <!-- PRODUCTOS -->
        <div id="productos" class="content">
            <h2>üì¶ Gesti√≥n de Productos</h2>
            
            <form onsubmit="guardarProducto(event)">
                <div class="form-row">
                    <div class="form-col">
                        <label>ID Producto:</label>
                        <input type="text" id="productoId" required>
                    </div>
                    <div class="form-col">
                        <label>Nombre:</label>
                        <input type="text" id="productoNombre" required>
                    </div>
                    <div class="form-col">
                        <label>Precio:</label>
                        <input type="number" id="productoPrecio" step="0.01" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label>Tipo:</label>
                        <select id="productoTipo" onchange="toggleComponentes()" required>
                            <option value="">Seleccionar...</option>
                            <option value="simple">Producto Simple</option>
                            <option value="caja">Caja con Componentes</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>Stock:</label>
                        <input type="number" id="productoStock" value="0">
                    </div>
                </div>

                <div id="componentes-section" style="display: none;">
                    <h3>Componentes de la Caja</h3>
                    <div class="form-row">
                        <div class="form-col">
                            <label>ID Componente:</label>
                            <input type="text" id="componenteId" placeholder="ID del producto componente">
                        </div>
                        <div class="form-col">
                            <label>Cantidad:</label>
                            <input type="number" id="componenteCantidad" min="1" placeholder="Cantidad">
                        </div>
                        <div class="form-col">
                            <button type="button" class="btn btn-primary" onclick="agregarComponente()">‚ûï Agregar</button>
                        </div>
                    </div>
                    <div id="lista-componentes"></div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Producto</button>
            </form>

            <div id="lista-productos"></div>
        </div>

        <!-- PEDIDOS -->
        <div id="pedidos" class="content">
            <h2>üìã Gesti√≥n de Pedidos</h2>
            
            <form onsubmit="guardarPedido(event)">
                <div class="form-row">
                    <div class="form-col">
                        <label>Cliente <span class="required">*</span>:</label>
                        <select id="pedidoCliente" required>
                            <option value="">Seleccionar cliente...</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>Fecha <span class="required">*</span>:</label>
                        <input type="date" id="pedidoFecha" required>
                    </div>
                    <div class="form-col">
                        <label>Horario <span class="required">*</span>:</label>
                        <select id="pedidoHorario" required>
                            <option value="">Seleccionar...</option>
                            <option value="Ma√±ana">Ma√±ana</option>
                            <option value="Tarde">Tarde</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label>Producto:</label>
                        <select id="pedidoProducto">
                            <option value="">Seleccionar producto...</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>Cantidad:</label>
                        <input type="number" id="pedidoCantidad" min="1" value="1">
                    </div>
                    <div class="form-col">
                        <button type="button" class="btn btn-primary" onclick="agregarProductoAPedido()">‚ûï Agregar</button>
                    </div>
                </div>

                <div id="productos-en-pedido"></div>

                <div class="form-row">
                    <div class="form-col">
                        <label>Costo Env√≠o:</label>
                        <input type="number" id="pedidoEnvio" step="0.01" value="0" onchange="calcularTotalPedido()">
                    </div>
                    <div class="form-col">
                        <strong>TOTAL: $<span id="totalPedido">0.00</span></strong>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Pedido</button>
            </form>

            <div id="lista-pedidos"></div>
        </div>

        <!-- PAGOS -->
        <div id="pagos" class="content">
            <h2>üí∞ Gesti√≥n de Pagos</h2>
            
            <form onsubmit="guardarPago(event)">
                <div class="form-row">
                    <div class="form-col">
                        <label>Pedido:</label>
                        <select id="pagoPedido" required>
                            <option value="">Seleccionar pedido...</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>Monto:</label>
                        <input type="number" id="pagoMonto" step="0.01" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label>M√©todo:</label>
                        <select id="pagoMetodo" required>
                            <option value="">Seleccionar...</option>
                            <option value="Mercado Pago">Mercado Pago</option>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Transferencia">Transferencia</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>Fecha:</label>
                        <input type="date" id="pagoFecha" required>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üí∞ Registrar Pago</button>
            </form>

            <div id="lista-pagos"></div>
        </div>
    </div>

    <script>
        let clientes = JSON.parse(localStorage.getItem('sistema_pastrami_clientes') || '[]');
        let productos = JSON.parse(localStorage.getItem('sistema_pastrami_productos') || '[]');
        let pedidos = JSON.parse(localStorage.getItem('sistema_pastrami_pedidos') || '[]');
        let pagos = JSON.parse(localStorage.getItem('sistema_pastrami_pagos') || '[]');
        let productosEnPedido = [];
        let componentesTemp = [];
        let contadorId = Math.max(0, ...clientes.map(c => c.id || 0)) + 1;

        function mostrarTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function guardarCliente(event) {
            event.preventDefault();
            
            const cliente = {
                id: contadorId++,
                nombre: document.getElementById('nombre').value,
                apellido: document.getElementById('apellido').value,
                telefono: document.getElementById('telefono').value,
                calle: document.getElementById('calle').value,
                numero: document.getElementById('numero').value,
                piso: document.getElementById('piso').value,
                codigoPostal: document.getElementById('codigoPostal').value,
                localidad: document.getElementById('localidad').value,
                email: document.getElementById('email').value
            };
            
            clientes.push(cliente);
            localStorage.setItem('sistema_pastrami_clientes', JSON.stringify(clientes));
            
            // FORZAR SINCRONIZACI√ìN
            setTimeout(function() {
                window.location.reload();
            }, 500);
            
            mostrarClientes();
            actualizarSelects();
            event.target.reset();
            alert('Cliente guardado');
        }

        function mostrarClientes() {
            const lista = document.getElementById('lista-clientes');
            
            if (clientes.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay clientes</div>';
                return;
            }
            
            lista.innerHTML = clientes.map(c => {
                let direccion = '';
                if (c.calle) direccion += c.calle;
                if (c.numero) direccion += ' ' + c.numero;
                if (c.piso) direccion += ', ' + c.piso;
                if (c.localidad) direccion += ', ' + c.localidad;
                if (c.codigoPostal) direccion += ' (' + c.codigoPostal + ')';
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div><strong>ID: ${c.id} - ${c.nombre} ${c.apellido}</strong></div>
                            <button class="btn btn-danger" onclick="eliminarCliente(${c.id})">üóëÔ∏è</button>
                        </div>
                        <div>Tel: ${c.telefono}</div>
                        ${c.email ? `<div>Email: ${c.email}</div>` : ''}
                        ${direccion ? `<div>Dir: ${direccion}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function eliminarCliente(id) {
            if (confirm('¬øEliminar cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                localStorage.setItem('sistema_pastrami_clientes', JSON.stringify(clientes));
                
                // FORZAR SINCRONIZACI√ìN
                setTimeout(function() {
                    window.location.reload();
                }, 500);
                
                mostrarClientes();
                actualizarSelects();
            }
        }

        function toggleComponentes() {
            const tipo = document.getElementById('productoTipo').value;
            const section = document.getElementById('componentes-section');
            
            if (tipo === 'caja') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                componentesTemp = [];
                mostrarComponentes();
            }
        }

        function agregarComponente() {
            const id = document.getElementById('componenteId').value.trim();
            const cantidad = parseInt(document.getElementById('componenteCantidad').value);
            
            if (!id || !cantidad) {
                alert('Completa ID y cantidad');
                return;
            }
            
            const existe = productos.find(p => p.id === id);
            if (!existe) {
                alert('El producto componente no existe. Cr√©alo primero.');
                return;
            }
            
            const yaAgregado = componentesTemp.find(c => c.id === id);
            if (yaAgregado) {
                alert('Componente ya agregado');
                return;
            }
            
            componentesTemp.push({
                id: id,
                nombre: existe.nombre,
                cantidad: cantidad
            });
            
            mostrarComponentes();
            document.getElementById('componenteId').value = '';
            document.getElementById('componenteCantidad').value = '';
        }

        function mostrarComponentes() {
            const lista = document.getElementById('lista-componentes');
            
            if (componentesTemp.length === 0) {
                lista.innerHTML = '<div style="color: #666; padding: 10px;">Sin componentes</div>';
                return;
            }
            
            lista.innerHTML = componentesTemp.map((comp, index) => `
                <div class="item">
                    <div class="item-header">
                        <div><strong>${comp.id}</strong> - ${comp.nombre} (${comp.cantidad} unidades)</div>
                        <button class="btn btn-danger" onclick="quitarComponente(${index})">‚ùå</button>
                    </div>
                </div>
            `).join('');
        }

        function quitarComponente(index) {
            componentesTemp.splice(index, 1);
            mostrarComponentes();
        }

        function guardarProducto(event) {
            event.preventDefault();
            
            const tipo = document.getElementById('productoTipo').value;
            
            if (tipo === 'caja' && componentesTemp.length === 0) {
                alert('Las cajas deben tener componentes');
                return;
            }
            
            const producto = {
                id: document.getElementById('productoId').value,
                nombre: document.getElementById('productoNombre').value,
                precio: parseFloat(document.getElementById('productoPrecio').value),
                stock: parseInt(document.getElementById('productoStock').value),
                tipo: tipo,
                componentes: tipo === 'caja' ? componentesTemp.slice() : []
            };
            
            if (productos.find(p => p.id === producto.id)) {
                alert('Ya existe ese ID');
                return;
            }
            
            productos.push(producto);
            localStorage.setItem('sistema_pastrami_productos', JSON.stringify(productos));
            
            // FORZAR SINCRONIZACI√ìN
            setTimeout(function() {
                window.location.reload();
            }, 500);
            
            mostrarProductos();
            actualizarSelects();
            componentesTemp = [];
            mostrarComponentes();
            document.getElementById('componentes-section').style.display = 'none';
            event.target.reset();
            alert('Producto guardado');
        }

        function mostrarProductos() {
            const lista = document.getElementById('lista-productos');
            
            if (productos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay productos</div>';
                return;
            }
            
            lista.innerHTML = productos.map(p => `
                <div class="item">
                    <div class="item-header">
                        <div><strong>${p.id} - ${p.nombre}</strong></div>
                        <button class="btn btn-danger" onclick="eliminarProducto('${p.id}')">üóëÔ∏è</button>
                    </div>
                    <div>Precio: ${p.precio.toFixed(2)} | Stock: ${p.stock} | Tipo: ${p.tipo === 'caja' ? 'Caja' : 'Simple'}</div>
                    ${p.tipo === 'caja' && p.componentes ? `
                        <div style="background: #e9ecef; padding: 10px; margin-top: 10px; border-radius: 5px;">
                            <strong>Componentes:</strong><br>
                            ${p.componentes.map(comp => `‚Ä¢ ${comp.cantidad}x ${comp.id} - ${comp.nombre}`).join('<br>')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function eliminarProducto(id) {
            if (confirm('¬øEliminar producto?')) {
                productos = productos.filter(p => p.id !== id);
                localStorage.setItem('sistema_pastrami_productos', JSON.stringify(productos));
                
                // FORZAR SINCRONIZACI√ìN
                setTimeout(function() {
                    window.location.reload();
                }, 500);
                
                mostrarProductos();
                actualizarSelects();
            }
        }

        function agregarProductoAPedido() {
            const productoId = document.getElementById('pedidoProducto').value;
            const cantidad = parseInt(document.getElementById('pedidoCantidad').value);
            
            if (!productoId) {
                alert('Selecciona producto');
                return;
            }
            
            const producto = productos.find(p => p.id === productoId);
            const existe = productosEnPedido.find(p => p.id === productoId);
            
            if (existe) {
                existe.cantidad += cantidad;
            } else {
                productosEnPedido.push({
                    id: producto.id,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: cantidad
                });
            }
            
            mostrarProductosEnPedido();
            document.getElementById('pedidoProducto').value = '';
            document.getElementById('pedidoCantidad').value = 1;
        }

        function mostrarProductosEnPedido() {
            const container = document.getElementById('productos-en-pedido');
            
            if (productosEnPedido.length === 0) {
                container.innerHTML = '<div style="color: #666; padding: 10px;">Sin productos</div>';
                calcularTotalPedido();
                return;
            }
            
            container.innerHTML = productosEnPedido.map((item, index) => `
                <div class="item">
                    <div class="item-header">
                        <div>${item.cantidad}x ${item.nombre} - $${item.precio.toFixed(2)}</div>
                        <div>
                            <strong>$${(item.precio * item.cantidad).toFixed(2)}</strong>
                            <button class="btn btn-danger" onclick="quitarProducto(${index})">‚ùå</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            calcularTotalPedido();
        }

        function quitarProducto(index) {
            productosEnPedido.splice(index, 1);
            mostrarProductosEnPedido();
        }

        function calcularTotalPedido() {
            const subtotal = productosEnPedido.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const envio = parseFloat(document.getElementById('pedidoEnvio').value) || 0;
            document.getElementById('totalPedido').textContent = (subtotal + envio).toFixed(2);
        }

        function guardarPedido(event) {
            event.preventDefault();
            
            if (productosEnPedido.length === 0) {
                alert('Agrega productos');
                return;
            }
            
            const clienteId = parseInt(document.getElementById('pedidoCliente').value);
            const cliente = clientes.find(c => c.id === clienteId);
            const subtotal = productosEnPedido.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const envio = parseFloat(document.getElementById('pedidoEnvio').value) || 0;
            
            const pedido = {
                id: Date.now(),
                clienteId: clienteId,
                clienteNombre: cliente.nombre + ' ' + cliente.apellido,
                fecha: document.getElementById('pedidoFecha').value,
                horario: document.getElementById('pedidoHorario').value,
                productos: productosEnPedido.slice(),
                subtotal: subtotal,
                envio: envio,
                total: subtotal + envio,
                estado: 'Pendiente'
            };
            
            pedidos.push(pedido);
            localStorage.setItem('sistema_pastrami_pedidos', JSON.stringify(pedidos));
            
            // FORZAR SINCRONIZACI√ìN
            setTimeout(function() {
                window.location.reload();
            }, 500);
            
            mostrarPedidos();
            actualizarSelects();
            productosEnPedido = [];
            mostrarProductosEnPedido();
            event.target.reset();
            alert('Pedido guardado');
        }

        function mostrarPedidos() {
            const lista = document.getElementById('lista-pedidos');
            
            if (pedidos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay pedidos</div>';
                return;
            }
            
            lista.innerHTML = pedidos.map(p => {
                const totalPagado = calcularTotalPagado(p.id);
                const saldo = p.total - totalPagado;
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div><strong>Pedido #${p.id} - ${p.clienteNombre}</strong></div>
                            <button class="btn btn-danger" onclick="eliminarPedido(${p.id})">üóëÔ∏è</button>
                        </div>
                        <div>${p.fecha} - ${p.horario}</div>
                        <div>Total: $${p.total.toFixed(2)} | Pagado: $${totalPagado.toFixed(2)} | Saldo: $${saldo.toFixed(2)}</div>
                        <div>Estado: ${p.estado}</div>
                    </div>
                `;
            }).join('');
        }

        function eliminarPedido(id) {
            if (confirm('¬øEliminar pedido?')) {
                pedidos = pedidos.filter(p => p.id !== id);
                localStorage.setItem('sistema_pastrami_pedidos', JSON.stringify(pedidos));
                
                // FORZAR SINCRONIZACI√ìN
                setTimeout(function() {
                    window.location.reload();
                }, 500);
                
                mostrarPedidos();
                actualizarSelects();
            }
        }

        function guardarPago(event) {
            event.preventDefault();
            
            const pago = {
                id: Date.now(),
                pedidoId: parseInt(document.getElementById('pagoPedido').value),
                monto: parseFloat(document.getElementById('pagoMonto').value),
                metodo: document.getElementById('pagoMetodo').value,
                fecha: document.getElementById('pagoFecha').value
            };
            
            pagos.push(pago);
            localStorage.setItem('sistema_pastrami_pagos', JSON.stringify(pagos));
            
            // FORZAR SINCRONIZACI√ìN
            setTimeout(function() {
                window.location.reload();
            }, 500);
            
            mostrarPagos();
            mostrarPedidos();
            actualizarSelects();
            event.target.reset();
            document.getElementById('pagoFecha').value = new Date().toISOString().split('T')[0];
            alert('Pago registrado');
        }

        function mostrarPagos() {
            const lista = document.getElementById('lista-pagos');
            
            if (pagos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay pagos</div>';
                return;
            }
            
            lista.innerHTML = pagos.map(p => {
                const pedido = pedidos.find(ped => ped.id === p.pedidoId);
                return `
                    <div class="item">
                        <div class="item-header">
                            <div><strong>$${p.monto.toFixed(2)} - ${p.metodo}</strong></div>
                            <button class="btn btn-danger" onclick="eliminarPago(${p.id})">üóëÔ∏è</button>
                        </div>
                        <div>Pedido: #${p.pedidoId} ${pedido ? '- ' + pedido.clienteNombre : ''}</div>
                        <div>Fecha: ${p.fecha}</div>
                    </div>
                `;
            }).join('');
        }

        function eliminarPago(id) {
            if (confirm('¬øEliminar pago?')) {
                pagos = pagos.filter(p => p.id !== id);
                localStorage.setItem('sistema_pastrami_pagos', JSON.stringify(pagos));
                
                // FORZAR SINCRONIZACI√ìN
                setTimeout(function() {
                    window.location.reload();
                }, 500);
                
                mostrarPagos();
                mostrarPedidos();
            }
        }

        function calcularTotalPagado(pedidoId) {
            return pagos.filter(p => p.pedidoId === pedidoId).reduce((sum, p) => sum + p.monto, 0);
        }

        function actualizarSelects() {
            const selectClientes = document.getElementById('pedidoCliente');
            selectClientes.innerHTML = '<option value="">Seleccionar cliente...</option>';
            clientes.forEach(c => {
                selectClientes.innerHTML += `<option value="${c.id}">${c.nombre} ${c.apellido}</option>`;
            });

            const selectProductos = document.getElementById('pedidoProducto');
            selectProductos.innerHTML = '<option value="">Seleccionar producto...</option>';
            productos.forEach(p => {
                selectProductos.innerHTML += `<option value="${p.id}">${p.id} - ${p.nombre} ($${p.precio.toFixed(2)})</option>`;
            });

            const selectPedidos = document.getElementById('pagoPedido');
            selectPedidos.innerHTML = '<option value="">Seleccionar pedido...</option>';
            pedidos.forEach(p => {
                const totalPagado = calcularTotalPagado(p.id);
                const saldo = p.total - totalPagado;
                if (saldo > 0) {
                    selectPedidos.innerHTML += `<option value="${p.id}">Pedido #${p.id} - ${p.clienteNombre} (Saldo: $${saldo.toFixed(2)})</option>`;
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            mostrarClientes();
            mostrarProductos();
            mostrarPedidos();
            mostrarPagos();
            actualizarSelects();
            document.getElementById('pagoFecha').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>
