contents.forEach(content => content.classList.remove('active'));
            
            // Mostrar tab seleccionado
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // FUNCIONES DE CLIENTES
        document.getElementById('cliente-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('cliente-nombre').value.trim();
            const apellido = document.getElementById('cliente-apellido').value.trim();
            const telefono = document.getElementById('cliente-telefono').value.trim();
            const calle = document.getElementById('cliente-calle').value.trim();
            const numero = document.getElementById('cliente-numero').value.trim();
            const piso = document.getElementById('cliente-piso').value.trim();
            const codigoPostal = document.getElementById('cliente-codigo-postal').value.trim();
            const localidad = document.getElementById('cliente-localidad').value.trim();
            const email = document.getElementById('cliente-email').value.trim();
            
            if (!nombre || !apellido || !telefono) {
                alert('Nombre, Apellido y Tel√©fono son obligatorios');
                return;
            }
            
            const cliente = {
                id: editandoCliente ? editandoCliente.id : contadorClientes++,
                nombre,
                apellido,
                telefono,
                calle,
                numero,
                piso,
                codigoPostal,
                localidad,
                email,
                fechaCreacion: editandoCliente ? editandoCliente.fechaCreacion : new Date().toISOString().split('T')[0]
            };
            
            if (editandoCliente) {
                const index = clientes.findIndex(c => c.id === editandoCliente.id);
                clientes[index] = cliente;
                editandoCliente = null;
            } else {
                clientes.push(cliente);
            }
            
            localStorage.setItem('pastrami_clientes', JSON.stringify(clientes));
            mostrarClientes();
            limpiarFormularioCliente();
            alert('Cliente guardado exitosamente');
        });

        function mostrarClientes() {
            const lista = document.getElementById('clientes-lista');
            
            if (clientes.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay clientes registrados</div>';
                return;
            }
            
            // Ordenar clientes por ID (orden de creaci√≥n)
            const clientesOrdenados = [...clientes].sort((a, b) => a.id - b.id);
            
            lista.innerHTML = clientesOrdenados.map(cliente => {
                // Construir direcci√≥n completa
                let direccion = '';
                if (cliente.calle) direccion += cliente.calle;
                if (cliente.numero) direccion += ' ' + cliente.numero;
                if (cliente.piso) direccion += ', Piso/Dto ' + cliente.piso;
                if (cliente.localidad) direccion += ', ' + cliente.localidad;
                if (cliente.codigoPostal) direccion += ' (' + cliente.codigoPostal + ')';
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title">
                                <strong>ID: ${cliente.id}</strong> - ${cliente.nombre} ${cliente.apellido}
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-warning btn-small" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-small" onclick="eliminarCliente(${cliente.id})">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <strong>Tel√©fono:</strong> ${cliente.telefono}
                            ${cliente.email ? ` | <strong>Email:</strong> ${cliente.email}` : ''}
                            ${direccion ? `<br><strong>Direcci√≥n:</strong> ${direccion}` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function buscarClientes() {
            const busqueda = document.getElementById('buscar-clientes').value.toLowerCase();
            const items = document.querySelectorAll('#clientes-lista .item');
            
            items.forEach(item => {
                const texto = item.textContent.toLowerCase();
                if (texto.includes(busqueda)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;
            
            editandoCliente = cliente;
            
            document.getElementById('cliente-nombre').value = cliente.nombre;
            document.getElementById('cliente-apellido').value = cliente.apellido;
            document.getElementById('cliente-telefono').value = cliente.telefono;
            document.getElementById('cliente-calle').value = cliente.calle || '';
            document.getElementById('cliente-numero').value = cliente.numero || '';
            document.getElementById('cliente-piso').value = cliente.piso || '';
            document.getElementById('cliente-codigo-postal').value = cliente.codigoPostal || '';
            document.getElementById('cliente-localidad').value = cliente.localidad || '';
            document.getElementById('cliente-email').value = cliente.email || '';
        }

        function eliminarCliente(id) {
            // Verificar si tiene pedidos
            const tienePedidos = pedidos.some(p => p.clienteId === id);
            
            if (tienePedidos) {
                alert('No se puede eliminar este cliente porque tiene pedidos asociados.');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                localStorage.setItem('pastrami_clientes', JSON.stringify(clientes));
                mostrarClientes();
            }
        }

        function cancelarCliente() {
            limpiarFormularioCliente();
        }

        function limpiarFormularioCliente() {
            document.getElementById('cliente-form').reset();
            editandoCliente = null;
        }

        // FUNCIONES DE PRODUCTOS
        function toggleComponentes() {
            const tipo = document.getElementById('producto-tipo').value;
            const section = document.getElementById('componentes-section');
            
            if (tipo === 'caja') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                componentesTemp = [];
                mostrarComponentesTemp();
            }
        }

        function agregarComponente() {
            const id = document.getElementById('componente-id').value.trim();
            const cantidad = parseInt(document.getElementById('componente-cantidad').value);
            
            if (!id || !cantidad || cantidad < 1) {
                alert('Por favor ingresa ID del componente y cantidad v√°lidos');
                return;
            }
            
            // Verificar que el producto existe
            const productoExiste = productos.find(p => p.id === id);
            if (!productoExiste) {
                alert('El producto con ID "' + id + '" no existe. Cr√©alo primero.');
                return;
            }
            
            // Verificar que no est√© ya agregado
            const yaExiste = componentesTemp.find(c => c.id === id);
            if (yaExiste) {
                alert('Este componente ya est√° agregado');
                return;
            }
            
            componentesTemp.push({ id, cantidad, nombre: productoExiste.nombre });
            mostrarComponentesTemp();
            
            // Limpiar campos
            document.getElementById('componente-id').value = '';
            document.getElementById('componente-cantidad').value = '';
        }

        function mostrarComponentesTemp() {
            const lista = document.getElementById('componentes-list');
            if (componentesTemp.length === 0) {
                lista.innerHTML = '<p style="color: #6c757d; font-style: italic;">No hay componentes agregados</p>';
                return;
            }
            
            lista.innerHTML = `
                <div class="item-components">
                    ${componentesTemp.map((comp, index) => `
                        <div class="component-item">
                            <span><strong>${comp.id}</strong> - ${comp.nombre} (${comp.cantidad} unidades)</span>
                            <button type="button" class="btn btn-danger btn-small" onclick="eliminarComponenteTemp(${index})">‚ùå</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function eliminarComponenteTemp(index) {
            componentesTemp.splice(index, 1);
            mostrarComponentesTemp();
        }

        document.getElementById('producto-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('producto-id').value.trim();
            const nombre = document.getElementById('producto-nombre').value.trim();
            const precio = parseFloat(document.getElementById('producto-precio').value);
            const tipo = document.getElementById('producto-tipo').value;
            const stock = parseInt(document.getElementById('producto-stock').value) || 0;
            
            if (!id || !nombre || !precio || !tipo) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            // Verificar que el ID no existe (solo para productos nuevos)
            if (!editandoProducto) {
                const idExiste = productos.find(p => p.id === id);
                if (idExiste) {
                    alert('Ya existe un producto con este ID');
                    return;
                }
            }
            
            if (tipo === 'caja' && componentesTemp.length === 0) {
                alert('Los productos tipo caja deben tener al menos un componente');
                return;
            }
            
            const producto = {
                id,
                nombre,
                precio,
                tipo,
                stock,
                componentes: tipo === 'caja' ? [...componentesTemp] : [],
                fechaCreacion: editandoProducto ? editandoProducto.fechaCreacion : new Date().toISOString().split('T')[0]
            };
            
            if (editandoProducto) {
                const index = productos.findIndex(p => p.id === editandoProducto.id);
                productos[index] = producto;
                editandoProducto = null;
            } else {
                productos.push(producto);
            }
            
            localStorage.setItem('pastrami_productos', JSON.stringify(productos));
            mostrarProductos();
            limpiarFormularioProducto();
            alert('Producto guardado exitosamente');
        });

        function mostrarProductos() {
            const lista = document.getElementById('productos-lista');
            
            if (productos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay productos registrados</div>';
                return;
            }
            
            // Ordenar productos por ID
            const productosOrdenados = [...productos].sort((a, b) => a.id.localeCompare(b.id));
            
            lista.innerHTML = productosOrdenados.map(producto => {
                const stockBajo = producto.stock < 5;
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title">
                                <strong>ID: ${producto.id}</strong> - ${producto.nombre}
                                <span class="badge ${stockBajo ? 'badge-danger' : 'badge-success'}">
                                    Stock: ${producto.stock}
                                </span>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-info btn-small" onclick="ajustarStock('${producto.id}')">üì¶ Stock</button>
                                <button class="btn btn-warning btn-small" onclick="editarProducto('${producto.id}')">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-small" onclick="eliminarProducto('${producto.id}')">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <strong>Precio:</strong> ${producto.precio.toFixed(2)} | 
                            <strong>Tipo:</strong> ${producto.tipo === 'simple' ? 'Producto Simple' : 'Caja con Componentes'}
                        </div>
                        ${producto.tipo === 'caja' && producto.componentes.length > 0 ? `
                            <div class="item-components">
                                <strong>Componentes:</strong>
                                ${producto.componentes.map(comp => `
                                    <div class="component-item">
                                        <span><strong>${comp.id}</strong> - ${comp.nombre}</span>
                                        <span>${comp.cantidad} unidades</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function buscarProductos() {
            const busqueda = document.getElementById('buscar-productos').value.toLowerCase();
            const items = document.querySelectorAll('#productos-lista .item');
            
            items.forEach(item => {
                const texto = item.textContent.toLowerCase();
                if (texto.includes(busqueda)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function ajustarStock(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            const nuevoStock = prompt(`Stock actual de "${producto.nombre}": ${producto.stock}\n\nIngresa el nuevo stock:`, producto.stock);
            
            if (nuevoStock !== null && !isNaN(nuevoStock) && nuevoStock >= 0) {
                producto.stock = parseInt(nuevoStock);
                localStorage.setItem('pastrami_productos', JSON.stringify(productos));
                mostrarProductos();
            }
        }

        function editarProducto(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            editandoProducto = producto;
            componentesTemp = [...(producto.componentes || [])];
            
            document.getElementById('producto-id').value = producto.id;
            document.getElementById('producto-id').disabled = true; // No permitir cambiar el ID
            document.getElementById('producto-nombre').value = producto.nombre;
            document.getElementById('producto-precio').value = producto.precio;
            document.getElementById('producto-tipo').value = producto.tipo;
            document.getElementById('producto-stock').value = producto.stock;
            
            toggleComponentes();
            mostrarComponentesTemp();
        }

        function eliminarProducto(id) {
            // Verificar si est√° en alg√∫n pedido
            const estaEnPedidos = pedidos.some(pedido => 
                pedido.productos.some(prod => prod.id === id)
            );
            
            if (estaEnPedidos) {
                alert('No se puede eliminar este producto porque est√° en pedidos existentes.');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                localStorage.setItem('pastrami_productos', JSON.stringify(productos));
                mostrarProductos();
            }
        }

        function cancelarProducto() {
            limpiarFormularioProducto();
        }

        function limpiarFormularioProducto() {
            document.getElementById('producto-form').reset();
            document.getElementById('producto-id').disabled = false;
            editandoProducto = null;
            componentesTemp = [];
            document.getElementById('componentes-section').style.display = 'none';
            mostrarComponentesTemp();
        }

        // FUNCIONES DE PEDIDOS
        function buscarClientesPedido() {
            const busqueda = document.getElementById('pedido-cliente').value.toLowerCase();
            const autocomplete = document.getElementById('clientes-autocomplete');
            
            if (busqueda.length < 2) {
                autocomplete.style.display = 'none';
                return;
            }
            
            const clientesFiltrados = clientes.filter(cliente => 
                (cliente.nombre + ' ' + cliente.apellido).toLowerCase().includes(busqueda)
            );
            
            if (clientesFiltrados.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            autocomplete.innerHTML = clientesFiltrados.map(cliente => `
                <div class="autocomplete-item" onclick="seleccionarCliente(${cliente.id})">
                    <strong>ID: ${cliente.id}</strong> - ${cliente.nombre} ${cliente.apellido} - ${cliente.telefono}
                </div>
            `).join('');
            
            autocomplete.style.display = 'block';
        }

        function seleccionarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (cliente) {
                document.getElementById('pedido-cliente').value = `${cliente.nombre} ${cliente.apellido}`;
                document.getElementById('pedido-cliente').dataset.clienteId = id;
                document.getElementById('clientes-autocomplete').style.display = 'none';
            }
        }

        function buscarProductosPedido() {
            const busqueda = document.getElementById('productos-pedido-search').value.toLowerCase();
            const autocomplete = document.getElementById('productos-autocomplete');
            
            if (busqueda.length < 2) {
                autocomplete.style.display = 'none';
                return;
            }
            
            const productosFiltrados = productos.filter(producto => 
                producto.id.toLowerCase().includes(busqueda) || 
                producto.nombre.toLowerCase().includes(busqueda)
            );
            
            if (productosFiltrados.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            autocomplete.innerHTML = productosFiltrados.map(producto => `
                <div class="autocomplete-item" onclick="agregarProductoPedido('${producto.id}')">
                    <strong>${producto.id}</strong> - ${producto.nombre} - ${producto.precio.toFixed(2)} (Stock: ${producto.stock})
                </div>
            `).join('');
            
            autocomplete.style.display = 'block';
        }

        function agregarProductoPedido(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            // Verificar stock
            if (producto.stock <= 0) {
                alert('No hay stock disponible de este producto');
                return;
            }
            
            // Verificar si ya est√° agregado
            const existe = productosPedidoTemp.find(p => p.id === id);
            if (existe) {
                if (existe.cantidad >= producto.stock) {
                    alert('No puedes agregar m√°s cantidad, stock insuficiente');
                    return;
                }
                existe.cantidad++;
            } else {
                productosPedidoTemp.push({
                    id: producto.id,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: 1,
                    stockDisponible: producto.stock
                });
            }
            
            mostrarProductosPedido();
            document.getElementById('productos-pedido-search').value = '';
            document.getElementById('productos-autocomplete').style.display = 'none';
        }

        function mostrarProductosPedido() {
            const container = document.getElementById('productos-pedido-lista');
            
            if (productosPedidoTemp.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; font-style: italic;">No hay productos en el pedido</p>';
                calcularTotalPedido();
                return;
            }
            
            container.innerHTML = `
                <div class="item-components">
                    <h4>Productos del Pedido:</h4>
                    ${productosPedidoTemp.map((item, index) => {
                        const subtotal = item.precio * item.cantidad;
                        return `
                            <div class="component-item">
                                <div>
                                    <strong>${item.id}</strong> - ${item.nombre}<br>
                                    <small>${item.precio.toFixed(2)} c/u</small>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <button type="button" class="btn btn-secondary btn-small" onclick="cambiarCantidadProducto(${index}, -1)">-</button>
                                    <span style="min-width: 30px; text-align: center;">${item.cantidad}</span>
                                    <button type="button" class="btn btn-secondary btn-small" onclick="cambiarCantidadProducto(${index}, 1)">+</button>
                                    <span style="font-weight: 600; min-width: 80px;">${subtotal.toFixed(2)}</span>
                                    <button type="button" class="btn btn-danger btn-small" onclick="eliminarProductoPedido(${index})">‚ùå</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            calcularTotalPedido();
        }

        function cambiarCantidadProducto(index, cambio) {
            const item = productosPedidoTemp[index];
            const nuevaCantidad = item.cantidad + cambio;
            
            if (nuevaCantidad <= 0) {
                eliminarProductoPedido(index);
                return;
            }
            
            if (nuevaCantidad > item.stockDisponible) {
                alert('No hay suficiente stock disponible');
                return;
            }
            
            item.cantidad = nuevaCantidad;
            mostrarProductosPedido();
        }

        function eliminarProductoPedido(index) {
            productosPedidoTemp.splice(index, 1);
            mostrarProductosPedido();
        }

        function calcularTotalPedido() {
            const subtotal = productosPedidoTemp.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const costoEnvio = parseFloat(document.getElementById('pedido-envio').value) || 0;
            const total = subtotal + costoEnvio;
            
            document.getElementById('subtotal-productos').textContent = subtotal.toFixed(2);
            document.getElementById('costo-envio-display').textContent = costoEnvio.toFixed(2);
            document.getElementById('total-pedido').textContent = total.toFixed(2);
        }

        document.getElementById('pedido-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const clienteInput = document.getElementById('pedido-cliente');
            const clienteId = parseInt(clienteInput.dataset.clienteId);
            const clienteNombre = clienteInput.value.trim();
            const fecha = document.getElementById('pedido-fecha').value;
            const horario = document.getElementById('pedido-horario').value;
            const costoEnvio = parseFloat(document.getElementById('pedido-envio').value) || 0;
            
            if (!clienteId || !clienteNombre || !fecha || !horario) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (productosPedidoTemp.length === 0) {
                alert('Debes agregar al menos un producto al pedido');
                return;
            }
            
            const subtotalProductos = productosPedidoTemp.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const total = subtotalProductos + costoEnvio;
            
            const pedido = {
                id: editandoPedido ? editandoPedido.id : Date.now(),
                clienteId,
                clienteNombre,
                fecha,
                horario,
                productos: [...productosPedidoTemp],
                subtotalProductos,
                costoEnvio,
                total,
                estado: 'Pendiente',
                fechaCreacion: new Date().toISOString().split('T')[0]
            };
            
            // Actualizar stock
            if (!editandoPedido) {
                productosPedidoTemp.forEach(item => {
                    const producto = productos.find(p => p.id === item.id);
                    if (producto) {
                        producto.stock -= item.cantidad;
                        
                        // Si es una caja, restar componentes
                        if (producto.tipo === 'caja' && producto.componentes) {
                            producto.componentes.forEach(comp => {
                                const componente = productos.find(p => p.id === comp.id);
                                if (componente) {
                                    componente.stock -= (comp.cantidad * item.cantidad);
                                }
                            });
                        }
                    }
                });
                localStorage.setItem('pastrami_productos', JSON.stringify(productos));
            }
            
            if (editandoPedido) {
                const index = pedidos.findIndex(p => p.id === editandoPedido.id);
                pedidos[index] = pedido;
                editandoPedido = null;
            } else {
                pedidos.push(pedido);
            }
            
            localStorage.setItem('pastrami_pedidos', JSON.stringify(pedidos));
            mostrarPedidos();
            mostrarProductos(); // Actualizar vista de productos
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            limpiarFormularioPedido();
            alert('Pedido guardado exitosamente');
        });

        function mostrarPedidos() {
            const lista = document.getElementById('pedidos-lista');
            const filtro = document.getElementById('filtro-pedidos').value;
            
            let pedidosFiltrados = [...pedidos];
            
            if (filtro === 'pendientes') {
                pedidosFiltrados = pedidos.filter(p => p.estado === 'Pendiente');
            } else if (filtro === 'entregados') {
                pedidosFiltrados = pedidos.filter(p => p.estado === 'Entregado');
            }
            
            if (pedidosFiltrados.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay pedidos que mostrar</div>';
                return;
            }
            
            // Ordenar por fecha de entrega
            pedidosFiltrados.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            
            lista.innerHTML = pedidosFiltrados.map(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                const saldoPendiente = pedido.total - totalPagado;
                const estadoPago = saldoPendiente <= 0 ? 'Pagado' : (totalPagado > 0 ? 'Parcial' : 'Pendiente');
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title">
                                <strong>Pedido #${pedido.id}</strong> - ${pedido.clienteNombre}<br>
                                <small>${new Date(pedido.fecha).toLocaleDateString()} - ${pedido.horario}</small>
                                <div style="margin-top: 5px;">
                                    <span class="badge ${pedido.estado === 'Entregado' ? 'badge-success' : 'badge-warning'}">
                                        ${pedido.estado}
                                    </span>
                                    <span class="badge ${estadoPago === 'Pagado' ? 'badge-success' : estadoPago === 'Parcial' ? 'badge-warning' : 'badge-danger'}">
                                        ${estadoPago}
                                    </span>
                                </div>
                            </div>
                            <div class="item-actions">
                                ${pedido.estado === 'Pendiente' ? `
                                    <button class="btn btn-success btn-small" onclick="marcarEntregado(${pedido.id})">‚úÖ Entregar</button>
                                ` : ''}
                                <button class="btn btn-info btn-small" onclick="verDetallePedido(${pedido.id})">üëÅÔ∏è Ver</button>
                                <button class="btn btn-warning btn-small" onclick="editarPedido(${pedido.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-small" onclick="eliminarPedido(${pedido.id})">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <strong>Subtotal:</strong> ${pedido.subtotalProductos.toFixed(2)} | 
                            <strong>Env√≠o:</strong> ${pedido.costoEnvio.toFixed(2)} | 
                            <strong>Total:</strong> ${pedido.total.toFixed(2)}<br>
                            <strong>Pagado:</strong> <span class="amount-paid">${totalPagado.toFixed(2)}</span>
                            ${saldoPendiente > 0 ? ` | <strong>Pendiente:</strong> <span class="amount-pending">${saldoPendiente.toFixed(2)}</span>` : ''}
                        </div>
                        <div class="item-components">
                            <strong>Productos:</strong>
                            ${pedido.productos.map(prod => `
                                <div class="component-item">
                                    <span><strong>${prod.id}</strong> - ${prod.nombre}</span>
                                    <span>${prod.cantidad}x ${prod.precio.toFixed(2)} = ${(prod.precio * prod.cantidad).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filtrarPedidos() {
            mostrarPedidos();
        }

        function marcarEntregado(id) {
            if (confirm('¬øMarcar este pedido como entregado?')) {
                const index = pedidos.findIndex(p => p.id === id);
                if (index !== -1) {
                    pedidos[index].estado = 'Entregado';
                    localStorage.setItem('pastrami_pedidos', JSON.stringify(pedidos));
                    mostrarPedidos();
                }
            }
        }

        function verDetallePedido(id) {
            const pedido = pedidos.find(p => p.id === id);
            if (!pedido) return;
            
            const cliente = clientes.find(c => c.id === pedido.clienteId);
            const totalPagado = calcularTotalPagado(pedido.id);
            const saldoPendiente = pedido.total - totalPagado;
            
            let direccion = '';
            if (cliente) {
                if (cliente.calle) direccion += cliente.calle;
                if (cliente.numero) direccion += ' ' + cliente.numero;
                if (cliente.piso) direccion += ', Piso/Dto ' + cliente.piso;
                if (cliente.localidad) direccion += ', ' + cliente.localidad;
                if (cliente.codigoPostal) direccion += ' (' + cliente.codigoPostal + ')';
            }
            
            alert(`DETALLE DEL PEDIDO #${pedido.id}

CLIENTE:
${pedido.clienteNombre}${cliente ? '\nTel√©fono: ' + cliente.telefono : ''}${direccion ? '\nDirecci√≥n: ' + direccion : ''}

ENTREGA:
Fecha: ${new Date(pedido.fecha).toLocaleDateString()}
Horario: ${pedido.horario}

PRODUCTOS:
${pedido.productos.map(p => `‚Ä¢ ${p.cantidad}x ${p.nombre} - ${(p.precio * p.cantidad).toFixed(2)}`).join('\n')}

TOTALES:
Subtotal: ${pedido.subtotalProductos.toFixed(2)}
Env√≠o: ${pedido.costoEnvio.toFixed(2)}
TOTAL: ${pedido.total.toFixed(2)}

PAGOS:
Pagado: ${totalPagado.toFixed(2)}
Pendiente: ${saldoPendiente.toFixed(2)}

Estado: ${pedido.estado}`);
        }

        function editarPedido(id) {
            const pedido = pedidos.find(p => p.id === id);
            if (!pedido) return;
            
            editandoPedido = pedido;
            productosPedidoTemp = [...pedido.productos];
            
            document.getElementById('pedido-cliente').value = pedido.clienteNombre;
            document.getElementById('pedido-cliente').dataset.clienteId = pedido.clienteId;
            document.getElementById('pedido-fecha').value = pedido.fecha;
            document.getElementById('pedido-horario').value = pedido.horario;
            document.getElementById('pedido-envio').value = pedido.costoEnvio || 0;
            
            mostrarProductosPedido();
            
            // Cambiar a la pesta√±a de pedidos
            showTab('pedidos');
            document.querySelector('.tab[onclick="showTab(\'pedidos\')"]').classList.add('active');
        }

        function eliminarPedido(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este pedido? Tambi√©n se eliminar√°n todos los pagos asociados.')) {
                pedidos = pedidos.filter(p => p.id !== id);
                pagos = pagos.filter(p => p.pedidoId !== id);
                localStorage.setItem('pastrami_pedidos', JSON.stringify(pedidos));
                localStorage.setItem('pastrami_pagos', JSON.stringify(pagos));
                mostrarPedidos();
                mostrarPagos();
                actualizarSelectPedidos();
                actualizarEstadisticasPagos();
            }
        }

        function cancelarPedido() {
            limpiarFormularioPedido();
        }

        function limpiarFormularioPedido() {
            document.getElementById('pedido-form').reset();
            document.getElementById('pedido-cliente').dataset.clienteId = '';
            document.getElementById('clientes-autocomplete').style.display = 'none';
            document.getElementById('productos-autocomplete').style.display = 'none';
            editandoPedido = null;
            productosPedidoTemp = [];
            mostrarProductosPedido();
            document.getElementById('pedido-envio').value = 0;
            calcularTotalPedido();
        }

        // FUNCIONES DE PAGOS
        function actualizarSelectPedidos() {
            const select = document.getElementById('pago-pedido');
            select.innerHTML = '<option value="">Seleccionar pedido...</option>';
            
            // Solo mostrar pedidos que no est√©n completamente pagados
            const pedidosConSaldo = pedidos.filter(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                return totalPagado < pedido.total;
            });
            
            pedidosConSaldo.forEach(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                const saldo = pedido.total - totalPagado;
                select.innerHTML += `
                    <option value="${pedido.id}">
                        Pedido #${pedido.id} - ${pedido.clienteNombre} - Saldo: ${saldo.toFixed(2)}
                    </option>
                `;
            });
        }

        function actualizarInfoPago() {
            const pedidoId = parseInt(document.getElementById('pago-pedido').value);
            const infoDiv = document.getElementById('info-pago');
            
            if (!pedidoId) {
                infoDiv.style.display = 'none';
                return;
            }
            
            const pedido = pedidos.find(p => p.id === pedidoId);
            if (!pedido) return;
            
            const totalPagado = calcularTotalPagado(pedidoId);
            const saldoPendiente = pedido.total - totalPagado;
            const pagosPrevios = pagos.filter(p => p.pedidoId === pedidoId);
            
            // Sugerir el saldo completo como monto
            document.getElementById('pago-monto').value = saldoPendiente.toFixed(2);
            
            infoDiv.innerHTML = `
                <div class="payment-info">
                    <h4>Informaci√≥n del Pedido #${pedido.id}</h4>
                    <div class="payment-row">
                        <span><strong>Cliente:</strong> ${pedido.clienteNombre}</span>
                    </div>
                    <div class="payment-row">
                        <span><strong>Fecha entrega:</strong> ${new Date(pedido.fecha).toLocaleDateString()} - ${pedido.horario}</span>
                    </div>
                    <div class="payment-row">
                        <span><strong>Total pedido:</strong></span>
                        <span class="amount">${pedido.total.toFixed(2)}</span>
                    </div>
                    <div class="payment-row">
                        <span><strong>Ya pagado:</strong></span>
                        <span class="amount-paid">${totalPagado.toFixed(2)}</span>
                    </div>
                    <div class="payment-row">
                        <span><strong>Saldo pendiente:</strong></span>
                        <span class="amount-pending">${saldoPendiente.toFixed(2)}</span>
                    </div>
                    <div class="payment-row">
                        <span><strong>Pagos realizados:</strong> ${pagosPrevios.length}</span>
                    </div>
                    ${pagosPrevios.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <strong>Historial de pagos:</strong>
                            ${pagosPrevios.map(pago => `
                                <div style="background: #e9ecef; padding: 8px; border-radius: 4px; margin: 5px 0;">
                                    ${new Date(pago.fecha).toLocaleDateString()} - ${pago.monto.toFixed(2)} (${pago.metodo})
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            
            infoDiv.style.display = 'block';
        }

        document.getElementById('pago-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const pedidoId = parseInt(document.getElementById('pago-pedido').value);
            const monto = parseFloat(document.getElementById('pago-monto').value);
            const metodo = document.getElementById('pago-metodo').value;
            const fecha = document.getElementById('pago-fecha').value;
            
            if (!pedidoId || !monto || !metodo || !fecha) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (monto <= 0) {
                alert('El monto debe ser mayor a 0');
                return;
            }
            
            const pedido = pedidos.find(p => p.id === pedidoId);
            const totalPagado = calcularTotalPagado(pedidoId);
            const saldoPendiente = pedido.total - totalPagado;
            
            if (monto > saldoPendiente) {
                if (!confirm(`El monto (${monto.toFixed(2)}) es mayor al saldo pendiente (${saldoPendiente.toFixed(2)}). ¬øContinuar?`)) {
                    return;
                }
            }
            
            const pago = {
                id: Date.now(),
                pedidoId,
                monto,
                metodo,
                fecha,
                fechaRegistro: new Date().toISOString()
            };
            
            pagos.push(pago);
            localStorage.setItem('pastrami_pagos', JSON.stringify(pagos));
            
            mostrarPagos();
            mostrarPedidos();
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            limpiarFormularioPago();
            
            alert('Pago registrado exitosamente');
        });

        function mostrarPagos() {
            const saldosTabla = document.getElementById('saldos-pendientes');
            const pagosLista = document.getElementById('pagos-lista');
            
            // Mostrar saldos pendientes
            const pedidosConSaldo = pedidos.filter(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                return totalPagado < pedido.total;
            });
            
            if (pedidosConSaldo.length === 0) {
                saldosTabla.innerHTML = '<div class="no-items">¬°Todos los pedidos est√°n pagados!</div>';
            } else {
                saldosTabla.innerHTML = pedidosConSaldo.map(pedido => {
                    const totalPagado = calcularTotalPagado(pedido.id);
                    const saldo = pedido.total - totalPagado;
                    
                    return `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title">
                                    <strong>Pedido #${pedido.id}</strong> - ${pedido.clienteNombre}<br>
                                    <small>${new Date(pedido.fecha).toLocaleDateString()} - ${pedido.horario}</small>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-primary btn-small" onclick="pagarRapido(${pedido.id})">üí∞ Pagar</button>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Total:</strong> ${pedido.total.toFixed(2)} | 
                                <strong>Pagado:</strong> <span class="amount-paid">${totalPagado.toFixed(2)}</span> | 
                                <strong>Pendiente:</strong> <span class="amount-pending">${saldo.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Mostrar historial de pagos
            if (pagos.length === 0) {
                pagosLista.innerHTML = '<div class="no-items">No hay pagos registrados</div>';
            } else {
                const pagosOrdenados = [...pagos].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                
                pagosLista.innerHTML = pagosOrdenados.map(pago => {
                    const pedido = pedidos.find(p => p.id === pago.pedidoId);
                    
                    return `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title">
                                    <strong>${pago.monto.toFixed(2)}</strong> - ${pago.metodo}<br>
                                    <small>${new Date(pago.fecha).toLocaleDateString()}</small>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-danger btn-small" onclick="eliminarPago(${pago.id})">üóëÔ∏è Eliminar</button>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Pedido:</strong> #${pago.pedidoId} - ${pedido ? pedido.clienteNombre : 'Cliente eliminado'}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function pagarRapido(pedidoId) {
            document.getElementById('pago-pedido').value = pedidoId;
            actualizarInfoPago();
        }

        function eliminarPago(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este pago?')) {
                pagos = pagos.filter(p => p.id !== id);
                localStorage.setItem('pastrami_pagos', JSON.stringify(pagos));
                mostrarPagos();
                mostrarPedidos();
                actualizarSelectPedidos();
                actualizarEstadisticasPagos();
            }
        }

        function cancelarPago() {
            limpiarFormularioPago();
        }

        function limpiarFormularioPago() {
            document.getElementById('pago-form').reset();
            document.getElementById('info-pago').style.display = 'none';
            document.getElementById('pago-fecha').value = new Date().toISOString().split('T')[0];
        }

        // FUNCIONES DE C√ÅLCULO
        function calcularTotalPagado(pedidoId) {
            return pagos
                .filter(pago => pago.pedidoId === pedidoId)
                .reduce((total, pago) => total + pago.monto, 0);
        }

        function actualizarEstadisticasPagos() {
            const totalPendiente = pedidos.reduce((total, pedido) => {
                const pagado = calcularTotalPagado(pedido.id);
                return total + Math.max(0, pedido.total - pagado);
            }, 0);
            
            const totalCobrado = pagos.reduce((total, pago) => total + pago.monto, 0);
            
            const pedidosImpagos = pedidos.filter(pedido => {
                const pagado = calcularTotalPagado(pedido.id);
                return pagado < pedido.total;
            }).length;
            
            document.getElementById('total-pendiente').textContent = `${totalPendiente.toFixed(0)}`;
            document.getElementById('total-cobrado').textContent = `${totalCobrado.toFixed(0)}`;
            document.getElementById('pedidos-impagos').textContent = pedidosImpagos;
        }

        // FUNCIONES DE ESTAD√çSTICAS
        function actualizarEstadisticas() {
            const fechaDesde = document.getElementById('fecha-desde').value;
            const fechaHasta = document.getElementById('fecha-hasta').value;
            
            if (!fechaDesde || !fechaHasta) {
                alert('Por favor selecciona el rango de fechas');
                return;
            }
            
            const pedidosFiltrados = pedidos.filter(pedido => {
                const fechaPedido = pedido.fechaCreacion;
                return fechaPedido >= fechaDesde && fechaPedido <= fechaHasta;
            });
            
            const totalVentas = pedidosFiltrados.reduce((sum, pedido) => sum + pedido.total, 0);
            const totalPedidos = pedidosFiltrados.length;
            
            // Clientes nuevos en el per√≠odo
            const clientesNuevos = clientes.filter(cliente => {
                return cliente.fechaCreacion >= fechaDesde && cliente.fechaCreacion <= fechaHasta;
            }).length;
            
            // Clientes recurrentes (m√°s de un pedido)
            const clientesConPedidos = {};
            pedidosFiltrados.forEach(pedido => {
                if (!clientesConPedidos[pedido.clienteId]) {
                    clientesConPedidos[pedido.clienteId] = 0;
                }
                clientesConPedidos[pedido.clienteId]++;
            });
            
            const clientesRecurrentes = Object.values(clientesConPedidos).filter(count => count > 1).length;
            
            document.getElementById('total-ventas').textContent = `${totalVentas.toFixed(0)}`;
            document.getElementById('total-pedidos').textContent = totalPedidos;
            document.getElementById('clientes-nuevos').textContent = clientesNuevos;
            document.getElementById('clientes-recurrentes').textContent = clientesRecurrentes;
        }

        function mostrarReporte(tipo) {
            const fechaDesde = document.getElementById('fecha-desde').value;
            const fechaHasta = document.getElementById('fecha-hasta').value;
            const resultado = document.getElementById('reporte-resultado');
            const titulo = document.getElementById('reporte-titulo');
            const contenido = document.getElementById('reporte-contenido');
            
            if (!fechaDesde || !fechaHasta) {
                alert('Por favor selecciona el rango de fechas');
                return;
            }
            
            const pedidosFiltrados = pedidos.filter(pedido => {
                const fechaPedido = pedido.fechaCreacion;
                return fechaPedido >= fechaDesde && fechaPedido <= fechaHasta;
            });
            
            let reporteHtml = '';
            
            switch (tipo) {
                case 'productos-vendidos':
                    titulo.textContent = 'üì¶ Productos M√°s Vendidos';
                    const productosVendidos = {};
                    
                    pedidosFiltrados.forEach(pedido => {
                        pedido.productos.forEach(prod => {
                            if (!productosVendidos[prod.id]) {
                                productosVendidos[prod.id] = {
                                    nombre: prod.nombre,
                                    cantidad: 0,
                                    ingresos: 0
                                };
                            }
                            productosVendidos[prod.id].cantidad += prod.cantidad;
                            productosVendidos[prod.id].ingresos += prod.precio * prod.cantidad;
                        });
                    });
                    
                    const productosOrdenados = Object.entries(productosVendidos)
                        .sort((a, b) => b[1].cantidad - a[1].cantidad);
                    
                    reporteHtml = productosOrdenados.map(([id, data]) => `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title"><strong>${id}</strong> - ${data.nombre}</div>
                                <div class="item-actions">
                                    <span class="badge badge-primary">${data.cantidad} vendidos</span>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Ingresos generados:</strong> ${data.ingresos.toFixed(2)}
                            </div>
                        </div>
                    `).join('');
                    break;
                    
                case 'clientes-top':
                    titulo.textContent = 'üë• Mejores Clientes';
                    const clientesCompras = {};
                    
                    pedidosFiltrados.forEach(pedido => {
                        if (!clientesCompras[pedido.clienteId]) {
                            clientesCompras[pedido.clienteId] = {
                                nombre: pedido.clienteNombre,
                                pedidos: 0,
                                total: 0
                            };
                        }
                        clientesCompras[pedido.clienteId].pedidos++;
                        clientesCompras[pedido.clienteId].total += pedido.total;
                    });
                    
                    const clientesOrdenados = Object.entries(clientesCompras)
                        .sort((a, b) => b[1].total - a[1].total);
                    
                    reporteHtml = clientesOrdenados.map(([id, data]) => `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title"><strong>ID: ${id}</strong> - ${data.nombre}</div>
                                <div class="item-actions">
                                    <span class="badge badge-success">${data.pedidos} pedidos</span>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Total comprado:</strong> ${data.total.toFixed(2)} | 
                                <strong>Promedio por pedido:</strong> ${(data.total / data.pedidos).toFixed(2)}
                            </div>
                        </div>
                    `).join('');
                    break;
                    
                case 'ventas-por-zona':
                    titulo.textContent = 'üìç Ventas por Zona (C√≥digo Postal)';
                    const ventasPorZona = {};
                    
                    pedidosFiltrados.forEach(pedido => {
                        const cliente = clientes.find(c => c.id === pedido.clienteId);
                        const zona = cliente && cliente.codigoPostal ? cliente.codigoPostal : 'Sin c√≥digo postal';
                        
                        if (!ventasPorZona[zona]) {
                            ventasPorZona[zona] = {
                                pedidos: 0,
                                total: 0
                            };
                        }
                        ventasPorZona[zona].pedidos++;
                        ventasPorZona[zona].total += pedido.total;
                    });
                    
                    const zonasOrdenadas = Object.entries(ventasPorZona)
                        .sort((a, b) => b[1].total - a[1].total);
                    
                    reporteHtml = zonasOrdenadas.map(([zona, data]) => `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title"><strong>CP: ${zona}</strong></div>
                                <div class="item-actions">
                                    <span class="badge badge-info">${data.pedidos} pedidos</span>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Total vendido:</strong> ${data.total.toFixed(2)} | 
                                <strong>Promedio por pedido:</strong> ${(data.total / data.pedidos).toFixed(2)}
                            </div>
                        </div>
                    `).join('');
                    break;
                    
                case 'metodos-pago':
                    titulo.textContent = 'üí≥ M√©todos de Pago';
                    const metodosPago = {};
                    
                    const pagosFiltrados = pagos.filter(pago => {
                        return pago.fecha >= fechaDesde && pago.fecha <= fechaHasta;
                    });
                    
                    pagosFiltrados.forEach(pago => {
                        if (!metodosPago[pago.metodo]) {
                            metodosPago[pago.metodo] = {
                                cantidad: 0,
                                total: 0
                            };
                        }
                        metodosPago[pago.metodo].cantidad++;
                        metodosPago[pago.metodo].total += pago.monto;
                    });
                    
                    const metodosOrdenados = Object.entries(metodosPago)
                        .sort((a, b) => b[1].total - a[1].total);
                    
                    reporteHtml = metodosOrdenados.map(([metodo, data]) => `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-title"><strong>${metodo}</strong></div>
                                <div class="item-actions">
                                    <span class="badge badge-primary">${data.cantidad} pagos</span>
                                </div>
                            </div>
                            <div class="item-details">
                                <strong>Total cobrado:</strong> ${data.total.toFixed(2)} | 
                                <strong>Promedio por pago:</strong> ${(data.total / data.cantidad).toFixed(2)}
                            </div>
                        </div>
                    `).join('');
                    break;
            }
            
            contenido.innerHTML = reporteHtml || '<div class="no-items">No hay datos para mostrar en el per√≠odo seleccionado</div>';
            resultado.style.display = 'block';
        }

        // Ocultar autocompletes al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#pedido-cliente') && !e.target.closest('#clientes-autocomplete')) {
                document.getElementById('clientes-autocomplete').style.display = 'none';
            }
            if (!e.target.closest('#productos-pedido-search') && !e.target.closest('#productos-autocomplete')) {
                document.getElementById('productos-autocomplete').style.display = 'none';
            }
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Pastrami - Gesti√≥n Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 20px 10px;
            text-align: center;
            background: #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1em;
        }

        .tab:hover {
            background: #dee2e6;
            transform: translateY(-2px);
        }

        .tab.active {
            background: white;
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-col {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .required {
            color: #dc3545;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Listas y tablas */
        .item-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .item:hover {
            transform: translateY(-2px);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .item-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #495057;
            flex: 1;
            min-width: 200px;
        }

        .item-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .item-details {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .item-components {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .component-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .component-item:last-child {
            border-bottom: none;
        }

        /* Estados y badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            display: inline-block;
            margin: 2px;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-primary {
            background: #cce5ff;
            color: #004085;
        }

        .no-items {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        /* Componentes espec√≠ficos */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .payment-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .payment-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .amount {
            font-weight: 600;
        }

        .amount-pending {
            color: #dc3545;
        }

        .amount-paid {
            color: #28a745;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .autocomplete-item:hover {
            background: #f8f9fa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .item-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .item-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•™ Sistema Pastrami</h1>
            <p>Gesti√≥n completa del emprendimiento</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('clientes')">üë• Clientes</div>
            <div class="tab" onclick="showTab('productos')">üì¶ Productos</div>
            <div class="tab" onclick="showTab('pedidos')">üìã Pedidos</div>
            <div class="tab" onclick="showTab('pagos')">üí∞ Pagos</div>
            <div class="tab" onclick="showTab('estadisticas')">üìä Estad√≠sticas</div>
        </div>

        <!-- TAB CLIENTES -->
        <div id="clientes" class="tab-content active">
            <h2>üë• Gesti√≥n de Clientes</h2>
            
            <form id="cliente-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-nombre">Nombre <span class="required">*</span>:</label>
                        <input type="text" id="cliente-nombre" required>
                    </div>
                    <div class="form-col">
                        <label for="cliente-apellido">Apellido <span class="required">*</span>:</label>
                        <input type="text" id="cliente-apellido" required>
                    </div>
                    <div class="form-col">
                        <label for="cliente-telefono">Tel√©fono <span class="required">*</span>:</label>
                        <input type="tel" id="cliente-telefono" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-calle">Calle:</label>
                        <input type="text" id="cliente-calle">
                    </div>
                    <div class="form-col">
                        <label for="cliente-numero">N√∫mero:</label>
                        <input type="text" id="cliente-numero">
                    </div>
                    <div class="form-col">
                        <label for="cliente-piso">Piso/Departamento:</label>
                        <input type="text" id="cliente-piso">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-codigo-postal">C√≥digo Postal:</label>
                        <input type="text" id="cliente-codigo-postal">
                    </div>
                    <div class="form-col">
                        <label for="cliente-localidad">Localidad:</label>
                        <input type="text" id="cliente-localidad">
                    </div>
                    <div class="form-col">
                        <label for="cliente-email">Email:</label>
                        <input type="email" id="cliente-email">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Cliente</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarCliente()">‚ùå Cancelar</button>
            </form>

            <div class="search-box">
                <input type="text" id="buscar-clientes" placeholder="Buscar clientes... (escribe las primeras letras)" onkeyup="buscarClientes()">
            </div>

            <div class="item-list">
                <h3>Lista de Clientes</h3>
                <div id="clientes-lista"></div>
            </div>
        </div>

        <!-- TAB PRODUCTOS -->
        <div id="productos" class="tab-content">
            <h2>üì¶ Gesti√≥n de Productos</h2>
            
            <form id="producto-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="producto-id">ID del Producto:</label>
                        <input type="text" id="producto-id" required placeholder="Ej: PAST001">
                    </div>
                    <div class="form-col">
                        <label for="producto-nombre">Nombre del Producto:</label>
                        <input type="text" id="producto-nombre" required>
                    </div>
                    <div class="form-col">
                        <label for="producto-precio">Precio:</label>
                        <input type="number" id="producto-precio" step="0.01" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="producto-tipo">Tipo de Producto:</label>
                        <select id="producto-tipo" onchange="toggleComponentes()" required>
                            <option value="">Seleccionar...</option>
                            <option value="simple">Producto Simple</option>
                            <option value="caja">Caja con Componentes</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="producto-stock">Stock Inicial:</label>
                        <input type="number" id="producto-stock" min="0" value="0">
                    </div>
                </div>

                <div id="componentes-section" style="display: none;">
                    <h3>üìã Componentes de la Caja</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">Los componentes se restar√°n autom√°ticamente del stock cuando se vendan.</p>
                    <div id="componentes-list"></div>
                    <div class="form-row">
                        <div class="form-col">
                            <input type="text" id="componente-id" placeholder="ID del componente (debe existir como producto)">
                        </div>
                        <div class="form-col">
                            <input type="number" id="componente-cantidad" placeholder="Cantidad" min="1">
                        </div>
                        <div class="form-col">
                            <button type="button" class="btn btn-secondary" onclick="agregarComponente()">‚ûï Agregar</button>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Producto</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarProducto()">‚ùå Cancelar</button>
            </form>

            <div class="search-box">
                <input type="text" id="buscar-productos" placeholder="Buscar productos... (escribe las primeras letras)" onkeyup="buscarProductos()">
            </div>

            <div class="item-list">
                <h3>Lista de Productos</h3>
                <div id="productos-lista"></div>
            </div>
        </div>

        <!-- TAB PEDIDOS -->
        <div id="pedidos" class="tab-content">
            <h2>üìã Gesti√≥n de Pedidos</h2>
            
            <form id="pedido-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="pedido-cliente">Cliente <span class="required">*</span>:</label>
                        <input type="text" id="pedido-cliente" required placeholder="Escribe el nombre del cliente..." onkeyup="buscarClientesPedido()" autocomplete="off">
                        <div id="clientes-autocomplete" style="display: none; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; background: white; position: absolute; z-index: 1000; width: calc(100% - 30px);"></div>
                    </div>
                    <div class="form-col">
                        <label for="pedido-fecha">Fecha de Entrega <span class="required">*</span>:</label>
                        <input type="date" id="pedido-fecha" required>
                    </div>
                    <div class="form-col">
                        <label for="pedido-horario">Horario <span class="required">*</span>:</label>
                        <select id="pedido-horario" required>
                            <option value="">Seleccionar...</option>
                            <option value="Ma√±ana">Ma√±ana</option>
                            <option value="Tarde">Tarde</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="productos-pedido-search">Agregar Productos:</label>
                    <input type="text" id="productos-pedido-search" placeholder="Escribe el nombre o ID del producto..." onkeyup="buscarProductosPedido()" autocomplete="off">
                    <div id="productos-autocomplete" style="display: none; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; background: white; position: absolute; z-index: 1000; width: calc(100% - 60px);"></div>
                </div>

                <div id="productos-pedido-lista"></div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="pedido-envio">Costo de Env√≠o:</label>
                        <input type="number" id="pedido-envio" step="0.01" value="0" onchange="calcularTotalPedido()">
                    </div>
                </div>

                <div class="payment-info">
                    <div class="payment-row">
                        <span>Subtotal Productos:</span>
                        <span class="amount">$<span id="subtotal-productos">0.00</span></span>
                    </div>
                    <div class="payment-row">
                        <span>Costo de Env√≠o:</span>
                        <span class="amount">$<span id="costo-envio-display">0.00</span></span>
                    </div>
                    <div class="payment-row" style="font-size: 1.2em; font-weight: bold; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 10px;">
                        <span>TOTAL:</span>
                        <span class="amount">$<span id="total-pedido">0.00</span></span>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Pedido</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarPedido()">‚ùå Cancelar</button>
            </form>

            <div class="item-list">
                <h3>Lista de Pedidos</h3>
                <div class="form-row">
                    <div class="form-col">
                        <select id="filtro-pedidos" onchange="filtrarPedidos()">
                            <option value="todos">Todos los pedidos</option>
                            <option value="pendientes">Pendientes de entrega</option>
                            <option value="entregados">Entregados</option>
                        </select>
                    </div>
                </div>
                <div id="pedidos-lista"></div>
            </div>
        </div>

        <!-- TAB PAGOS -->
        <div id="pagos" class="tab-content">
            <h2>üí∞ Gesti√≥n de Pagos</h2>

            <!-- Estad√≠sticas de pagos -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-pendiente">$0</div>
                    <div class="stat-label">Total Pendiente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-cobrado">$0</div>
                    <div class="stat-label">Total Cobrado</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pedidos-impagos">0</div>
                    <div class="stat-label">Pedidos Impagos</div>
                </div>
            </div>

            <!-- Formulario de registro de pago -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                <h3>üí≥ Registrar Pago</h3>
                <form id="pago-form">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="pago-pedido">Pedido:</label>
                            <select id="pago-pedido" required onchange="actualizarInfoPago()">
                                <option value="">Seleccionar pedido...</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="pago-monto">Monto del Pago:</label>
                            <input type="number" id="pago-monto" step="0.01" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="pago-metodo">M√©todo de Pago:</label>
                            <select id="pago-metodo" required>
                                <option value="">Seleccionar...</option>
                                <option value="Mercado Pago">Mercado Pago</option>
                                <option value="Efectivo">Efectivo</option>
                                <option value="Transferencia">Transferencia</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="pago-fecha">Fecha del Pago:</label>
                            <input type="date" id="pago-fecha" required>
                        </div>
                    </div>

                    <div id="info-pago" style="display: none;"></div>

                    <button type="submit" class="btn btn-primary">üí∞ Registrar Pago</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelarPago()">‚ùå Cancelar</button>
                </form>
            </div>

            <!-- Lista de pedidos con saldos pendientes -->
            <div class="item-list">
                <h3>üìã Pedidos con Saldos Pendientes</h3>
                <div id="saldos-pendientes"></div>
            </div>

            <!-- Historial de pagos -->
            <div class="item-list">
                <h3>üìã Historial de Pagos</h3>
                <div id="pagos-lista"></div>
            </div>
        </div>

        <!-- TAB ESTAD√çSTICAS -->
        <div id="estadisticas" class="tab-content">
            <h2>üìä Estad√≠sticas y Reportes</h2>
            
            <div class="form-row">
                <div class="form-col">
                    <label for="fecha-desde">Desde:</label>
                    <input type="date" id="fecha-desde">
                </div>
                <div class="form-col">
                    <label for="fecha-hasta">Hasta:</label>
                    <input type="date" id="fecha-hasta">
                </div>
                <div class="form-col" style="display: flex; align-items: end;">
                    <button class="btn btn-info" onclick="actualizarEstadisticas()">üîÑ Actualizar</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-ventas">$0</div>
                    <div class="stat-label">Total Ventas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-pedidos">0</div>
                    <div class="stat-label">Total Pedidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="clientes-nuevos">0</div>
                    <div class="stat-label">Clientes Nuevos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="clientes-recurrentes">0</div>
                    <div class="stat-label">Clientes Recurrentes</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <button class="btn btn-info" onclick="mostrarReporte('productos-vendidos')">üì¶ Productos M√°s Vendidos</button>
                </div>
                <div class="form-col">
                    <button class="btn btn-info" onclick="mostrarReporte('clientes-top')">üë• Mejores Clientes</button>
                </div>
                <div class="form-col">
                    <button class="btn btn-info" onclick="mostrarReporte('ventas-por-zona')">üìç Ventas por Zona</button>
                </div>
                <div class="form-col">
                    <button class="btn btn-info" onclick="mostrarReporte('metodos-pago')">üí≥ M√©todos de Pago</button>
                </div>
            </div>

            <div id="reporte-resultado" class="item-list" style="display: none;">
                <h3 id="reporte-titulo">Reporte</h3>
                <div id="reporte-contenido"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales para datos
        let clientes = JSON.parse(localStorage.getItem('pastrami_clientes') || '[]');
        let productos = JSON.parse(localStorage.getItem('pastrami_productos') || '[]');
        let pedidos = JSON.parse(localStorage.getItem('pastrami_pedidos') || '[]');
        let pagos = JSON.parse(localStorage.getItem('pastrami_pagos') || '[]');
        
        // Variables para edici√≥n
        let editandoCliente = null;
        let editandoProducto = null;
        let editandoPedido = null;
        let componentesTemp = [];
        let productosPedidoTemp = [];
        
        // Contadores
        let contadorClientes = Math.max(0, ...clientes.map(c => c.id || 0)) + 1;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            mostrarClientes();
            mostrarProductos();
            mostrarPedidos();
            mostrarPagos();
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            
            // Establecer fecha actual
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('pago-fecha').value = hoy;
            document.getElementById('fecha-hasta').value = hoy;
            
            // Fecha hace 30 d√≠as
            const hace30Dias = new Date();
            hace30Dias.setDate(hace30Dias.getDate() - 30);
            document.getElementById('fecha-desde').value = hace30Dias.toISOString().split('T')[0];
        });

        // FUNCIONES DE NAVEGACI√ìN
        function showTab(tabName) {
            // Ocultar todos los tabs
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove
