<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Pastrami - Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1em;
        }

        .tab:hover {
            background: #dee2e6;
            transform: translateY(-2px);
        }

        .tab.active {
            background: white;
            color: #ff6b6b;
            border-bottom: 3px solid #ff6b6b;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .required {
            color: #dc3545;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Listas y tablas */
        .item-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .item:hover {
            transform: translateY(-2px);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #495057;
        }

        .item-actions {
            display: flex;
            gap: 5px;
        }

        .item-details {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .item-components {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .component-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .component-item:last-child {
            border-bottom: none;
        }

        /* Estados y badges */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Componentes espec√≠ficos */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .no-items {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        /* Componentes de pagos */
        .payment-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .payment-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .payment-amount {
            font-weight: 600;
        }

        .debt-amount {
            color: #dc3545;
            font-weight: 600;
        }

        .paid-amount {
            color: #28a745;
            font-weight: 600;
        }

        /* Tabla de pagos */
        .payments-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .payments-table th,
        .payments-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .payments-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .payments-table tr:hover {
            background: #f8f9fa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü•™ Sistema Pastrami</h1>
            <p>Gesti√≥n completa de pastrami</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('productos')">üì¶ Productos</div>
            <div class="tab" onclick="showTab('clientes')">üë• Clientes</div>
            <div class="tab" onclick="showTab('pedidos')">üìã Pedidos</div>
            <div class="tab" onclick="showTab('pagos')">üí∞ Pagos</div>
        </div>

        <!-- TAB PRODUCTOS -->
        <div id="productos" class="tab-content active">
            <h2>üì¶ Gesti√≥n de Productos</h2>
            
            <form id="producto-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="producto-nombre">Nombre del Producto:</label>
                        <input type="text" id="producto-nombre" required>
                    </div>
                    <div class="form-col">
                        <label for="producto-precio">Precio:</label>
                        <input type="number" id="producto-precio" step="0.01" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="producto-tipo">Tipo de Producto:</label>
                        <select id="producto-tipo" onchange="toggleComponentes()" required>
                            <option value="">Seleccionar...</option>
                            <option value="simple">Producto Simple</option>
                            <option value="caja">Producto Caja (con componentes)</option>
                        </select>
                    </div>
                </div>

                <div id="componentes-section" style="display: none;">
                    <h3>Componentes de la Caja</h3>
                    <div id="componentes-list"></div>
                    <div class="form-row">
                        <div class="form-col">
                            <input type="text" id="componente-nombre" placeholder="Nombre del componente">
                        </div>
                        <div class="form-col">
                            <input type="number" id="componente-cantidad" placeholder="Cantidad" min="1">
                        </div>
                        <div class="form-col">
                            <button type="button" class="btn btn-secondary" onclick="agregarComponente()">Agregar</button>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Producto</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarEdicion()">‚ùå Cancelar</button>
            </form>

            <div class="item-list">
                <h3>Lista de Productos</h3>
                <div id="productos-lista"></div>
            </div>
        </div>

        <!-- TAB CLIENTES -->
        <div id="clientes" class="tab-content">
            <h2>üë• Gesti√≥n de Clientes</h2>
            
            <form id="cliente-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-nombre">Nombre <span class="required">*</span>:</label>
                        <input type="text" id="cliente-nombre" required>
                    </div>
                    <div class="form-col">
                        <label for="cliente-apellido">Apellido <span class="required">*</span>:</label>
                        <input type="text" id="cliente-apellido" required>
                    </div>
                    <div class="form-col">
                        <label for="cliente-telefono">Tel√©fono <span class="required">*</span>:</label>
                        <input type="tel" id="cliente-telefono" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-calle">Calle:</label>
                        <input type="text" id="cliente-calle">
                    </div>
                    <div class="form-col">
                        <label for="cliente-numero">N√∫mero:</label>
                        <input type="text" id="cliente-numero">
                    </div>
                    <div class="form-col">
                        <label for="cliente-piso">Piso:</label>
                        <input type="text" id="cliente-piso">
                    </div>
                    <div class="form-col">
                        <label for="cliente-departamento">Departamento:</label>
                        <input type="text" id="cliente-departamento">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="cliente-email">Email:</label>
                        <input type="email" id="cliente-email">
                    </div>
                    <div class="form-col">
                        <label for="cliente-localidad">Localidad:</label>
                        <input type="text" id="cliente-localidad">
                    </div>
                    <div class="form-col">
                        <label for="cliente-codigo-postal">C√≥digo Postal:</label>
                        <input type="text" id="cliente-codigo-postal">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Cliente</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarCliente()">‚ùå Cancelar</button>
            </form>

            <div class="item-list">
                <h3>Lista de Clientes</h3>
                <div id="clientes-lista"></div>
            </div>
        </div>

        <!-- TAB PEDIDOS -->
        <div id="pedidos" class="tab-content">
            <h2>üìã Gesti√≥n de Pedidos</h2>
            
            <form id="pedido-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="pedido-cliente">Cliente:</label>
                        <select id="pedido-cliente" required>
                            <option value="">Seleccionar cliente...</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="pedido-fecha">Fecha de Entrega:</label>
                        <input type="date" id="pedido-fecha" required>
                    </div>
                    <div class="form-col">
                        <label for="pedido-hora">Franja Horaria:</label>
                        <select id="pedido-hora" required>
                            <option value="">Seleccionar...</option>
                            <option value="Ma√±ana (9-12hs)">Ma√±ana (9-12hs)</option>
                            <option value="Mediod√≠a (12-15hs)">Mediod√≠a (12-15hs)</option>
                            <option value="Tarde (15-18hs)">Tarde (15-18hs)</option>
                            <option value="Noche (18-21hs)">Noche (18-21hs)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="pedido-productos">Productos:</label>
                    <select id="pedido-productos" onchange="agregarProductoPedido()">
                        <option value="">Seleccionar producto...</option>
                    </select>
                </div>

                <div id="productos-pedido"></div>

                <div class="form-group">
                    <label for="pedido-notas">Notas:</label>
                    <textarea id="pedido-notas" rows="3" placeholder="Instrucciones especiales..."></textarea>
                </div>

                <div class="form-group">
                    <strong>Total del Pedido: $<span id="total-pedido">0.00</span></strong>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Guardar Pedido</button>
                <button type="button" class="btn btn-secondary" onclick="cancelarPedido()">‚ùå Cancelar</button>
            </form>

            <div class="item-list">
                <h3>Lista de Pedidos</h3>
                <div id="pedidos-lista"></div>
            </div>
        </div>

        <!-- TAB PAGOS -->
        <div id="pagos" class="tab-content">
            <h2>üí∞ Gesti√≥n de Pagos</h2>

            <!-- Estad√≠sticas de pagos -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-pendiente">$0</div>
                    <div class="stat-label">Total Pendiente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-cobrado">$0</div>
                    <div class="stat-label">Total Cobrado</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pedidos-impagos">0</div>
                    <div class="stat-label">Pedidos Impagos</div>
                </div>
            </div>

            <!-- Formulario de registro de pago -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h3>üí≥ Registrar Nuevo Pago</h3>
                <form id="pago-form">
                    <div class="form-row">
                        <div class="form-col">
                            <label for="pago-pedido">Pedido:</label>
                            <select id="pago-pedido" required onchange="actualizarInfoPago()">
                                <option value="">Seleccionar pedido...</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="pago-monto">Monto del Pago:</label>
                            <input type="number" id="pago-monto" step="0.01" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="pago-metodo">M√©todo de Pago:</label>
                            <select id="pago-metodo" required>
                                <option value="">Seleccionar...</option>
                                <option value="efectivo">Efectivo</option>
                                <option value="transferencia">Transferencia</option>
                                <option value="tarjeta">Tarjeta</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="pago-fecha">Fecha del Pago:</label>
                            <input type="date" id="pago-fecha" required>
                        </div>
                    </div>

                    <div id="info-pago" style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0; display: none;">
                        <!-- Se llena din√°micamente -->
                    </div>

                    <div class="form-group">
                        <label for="pago-notas">Notas del Pago:</label>
                        <textarea id="pago-notas" rows="2" placeholder="Observaciones del pago..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">üí∞ Registrar Pago</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelarPago()">‚ùå Cancelar</button>
                </form>
            </div>

            <!-- Lista de todos los pagos -->
            <div style="background: white; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                <h3>üìã Historial de Pagos</h3>
                <table class="payments-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Pedido</th>
                            <th>Monto</th>
                            <th>M√©todo</th>
                            <th>Estado Pedido</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="pagos-lista">
                        <!-- Se llena din√°micamente -->
                    </tbody>
                </table>
            </div>

            <!-- Tabla de saldos pendientes -->
            <div style="background: #fff3cd; border-radius: 10px; padding: 20px;">
                <h3>‚ö†Ô∏è Saldos Pendientes</h3>
                <table class="payments-table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Pedido</th>
                            <th>Total Pedido</th>
                            <th>Pagado</th>
                            <th>Saldo Pendiente</th>
                            <th>Fecha Entrega</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="saldos-pendientes">
                        <!-- Se llena din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let productos = JSON.parse(localStorage.getItem('productos') || '[]');
        let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
        let pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
        let pagos = JSON.parse(localStorage.getItem('pagos') || '[]');
        let editandoProducto = null;
        let editandoCliente = null;
        let editandoPedido = null;
        let componentesTemp = [];
        let productosPedidoTemp = [];

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            mostrarProductos();
            mostrarClientes();
            mostrarPedidos();
            mostrarPagos();
            actualizarSelectProductos();
            actualizarSelectClientes();
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            
            // Establecer fecha actual
            document.getElementById('pago-fecha').value = new Date().toISOString().split('T')[0];
        });

        // FUNCIONES DE NAVEGACI√ìN
        function showTab(tabName) {
            // Ocultar todos los tabs
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            // Mostrar tab seleccionado
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // FUNCIONES DE PRODUCTOS
        function toggleComponentes() {
            const tipo = document.getElementById('producto-tipo').value;
            const section = document.getElementById('componentes-section');
            
            if (tipo === 'caja') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
                componentesTemp = [];
            }
        }

        function agregarComponente() {
            const nombre = document.getElementById('componente-nombre').value.trim();
            const cantidad = parseInt(document.getElementById('componente-cantidad').value);
            
            if (!nombre || !cantidad || cantidad < 1) {
                alert('Por favor ingresa nombre y cantidad v√°lidos para el componente');
                return;
            }
            
            componentesTemp.push({ nombre, cantidad });
            mostrarComponentesTemp();
            
            // Limpiar campos
            document.getElementById('componente-nombre').value = '';
            document.getElementById('componente-cantidad').value = '';
        }

        function mostrarComponentesTemp() {
            const lista = document.getElementById('componentes-list');
            if (componentesTemp.length === 0) {
                lista.innerHTML = '<p style="color: #6c757d; font-style: italic;">No hay componentes agregados</p>';
                return;
            }
            
            lista.innerHTML = componentesTemp.map((comp, index) => `
                <div class="component-item">
                    <span>${comp.cantidad}x ${comp.nombre}</span>
                    <button type="button" class="btn btn-danger btn-small" onclick="eliminarComponenteTemp(${index})">‚ùå</button>
                </div>
            `).join('');
        }

        function eliminarComponenteTemp(index) {
            componentesTemp.splice(index, 1);
            mostrarComponentesTemp();
        }

        document.getElementById('producto-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('producto-nombre').value.trim();
            const precio = parseFloat(document.getElementById('producto-precio').value);
            const tipo = document.getElementById('producto-tipo').value;
            
            if (!nombre || !precio || !tipo) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (tipo === 'caja' && componentesTemp.length === 0) {
                alert('Los productos tipo caja deben tener al menos un componente');
                return;
            }
            
            const producto = {
                id: editandoProducto ? editandoProducto.id : Date.now(),
                nombre,
                precio,
                tipo,
                componentes: tipo === 'caja' ? [...componentesTemp] : []
            };
            
            if (editandoProducto) {
                const index = productos.findIndex(p => p.id === editandoProducto.id);
                productos[index] = producto;
                editandoProducto = null;
            } else {
                productos.push(producto);
            }
            
            localStorage.setItem('productos', JSON.stringify(productos));
            mostrarProductos();
            actualizarSelectProductos();
            limpiarFormularioProducto();
        });

        function mostrarProductos() {
            const lista = document.getElementById('productos-lista');
            
            if (productos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay productos registrados</div>';
                return;
            }
            
            // Ordenar productos alfab√©ticamente
            const productosOrdenados = [...productos].sort((a, b) => a.nombre.localeCompare(b.nombre));
            
            lista.innerHTML = productosOrdenados.map(producto => `
                <div class="item">
                    <div class="item-header">
                        <div class="item-title">${producto.nombre}</div>
                        <div class="item-actions">
                            <button class="btn btn-warning btn-small" onclick="editarProducto(${producto.id})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-small" onclick="eliminarProducto(${producto.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                    <div class="item-details">
                        <strong>Precio:</strong> $${producto.precio.toFixed(2)} | 
                        <strong>Tipo:</strong> ${producto.tipo === 'simple' ? 'Producto Simple' : 'Producto Caja'}
                    </div>
                    ${producto.tipo === 'caja' && producto.componentes.length > 0 ? `
                        <div class="item-components">
                            <strong>Componentes:</strong>
                            ${producto.componentes.map(comp => `
                                <div class="component-item">
                                    <span>${comp.cantidad}x ${comp.nombre}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function editarProducto(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            editandoProducto = producto;
            componentesTemp = [...(producto.componentes || [])];
            
            document.getElementById('producto-nombre').value = producto.nombre;
            document.getElementById('producto-precio').value = producto.precio;
            document.getElementById('producto-tipo').value = producto.tipo;
            
            toggleComponentes();
            mostrarComponentesTemp();
        }

        function eliminarProducto(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                localStorage.setItem('productos', JSON.stringify(productos));
                mostrarProductos();
                actualizarSelectProductos();
            }
        }

        function cancelarEdicion() {
            limpiarFormularioProducto();
        }

        function limpiarFormularioProducto() {
            document.getElementById('producto-form').reset();
            editandoProducto = null;
            componentesTemp = [];
            document.getElementById('componentes-section').style.display = 'none';
            mostrarComponentesTemp();
        }

        // FUNCIONES DE CLIENTES
        document.getElementById('cliente-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('cliente-nombre').value.trim();
            const apellido = document.getElementById('cliente-apellido').value.trim();
            const telefono = document.getElementById('cliente-telefono').value.trim();
            const calle = document.getElementById('cliente-calle').value.trim();
            const numero = document.getElementById('cliente-numero').value.trim();
            const piso = document.getElementById('cliente-piso').value.trim();
            const departamento = document.getElementById('cliente-departamento').value.trim();
            const email = document.getElementById('cliente-email').value.trim();
            const localidad = document.getElementById('cliente-localidad').value.trim();
            const codigoPostal = document.getElementById('cliente-codigo-postal').value.trim();
            
            if (!nombre || !apellido || !telefono) {
                alert('Nombre, Apellido y Tel√©fono son obligatorios');
                return;
            }
            
            const cliente = {
                id: editandoCliente ? editandoCliente.id : Date.now(),
                nombre,
                apellido,
                telefono,
                calle,
                numero,
                piso,
                departamento,
                email,
                localidad,
                codigoPostal,
                fechaCreacion: editandoCliente ? editandoCliente.fechaCreacion : new Date().toISOString().split('T')[0]
            };
            
            if (editandoCliente) {
                const index = clientes.findIndex(c => c.id === editandoCliente.id);
                clientes[index] = cliente;
                editandoCliente = null;
            } else {
                clientes.push(cliente);
            }
            
            localStorage.setItem('clientes', JSON.stringify(clientes));
            mostrarClientes();
            actualizarSelectClientes();
            limpiarFormularioCliente();
        });

        function mostrarClientes() {
            const lista = document.getElementById('clientes-lista');
            
            if (clientes.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay clientes registrados</div>';
                return;
            }
            
            // Ordenar clientes alfab√©ticamente por apellido, luego nombre
            const clientesOrdenados = [...clientes].sort((a, b) => {
                const apellidoA = a.apellido.toLowerCase();
                const apellidoB = b.apellido.toLowerCase();
                if (apellidoA !== apellidoB) {
                    return apellidoA.localeCompare(apellidoB);
                }
                return a.nombre.toLowerCase().localeCompare(b.nombre.toLowerCase());
            });
            
            lista.innerHTML = clientesOrdenados.map(cliente => {
                // Calcular estad√≠sticas del cliente
                const nombreCompleto = `${cliente.nombre} ${cliente.apellido}`;
                const pedidosCliente = pedidos.filter(p => p.cliente === nombreCompleto);
                const totalPedidos = pedidosCliente.length;
                const totalComprado = pedidosCliente.reduce((sum, p) => sum + p.total, 0);
                
                // Construir direcci√≥n
                let direccion = '';
                if (cliente.calle || cliente.numero) {
                    direccion = `${cliente.calle || ''} ${cliente.numero || ''}`.trim();
                    if (cliente.piso) direccion += `, Piso ${cliente.piso}`;
                    if (cliente.departamento) direccion += `, Dto ${cliente.departamento}`;
                    if (cliente.localidad) direccion += `, ${cliente.localidad}`;
                    if (cliente.codigoPostal) direccion += ` (${cliente.codigoPostal})`;
                }
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title">${nombreCompleto}</div>
                            <div class="item-actions">
                                <button class="btn btn-warning btn-small" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-small" onclick="eliminarCliente(${cliente.id})">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <strong>Tel√©fono:</strong> ${cliente.telefono}
                            ${cliente.email ? ` | <strong>Email:</strong> ${cliente.email}` : ''}
                            | <strong>Pedidos realizados:</strong> ${totalPedidos}
                            ${totalPedidos > 0 ? ` | <strong>Total comprado:</strong> ${totalComprado.toFixed(2)}` : ''}
                        </div>
                        ${direccion ? `
                            <div class="item-details">
                                <strong>Direcci√≥n:</strong> ${direccion}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;
            
            editandoCliente = cliente;
            
            document.getElementById('cliente-nombre').value = cliente.nombre;
            document.getElementById('cliente-apellido').value = cliente.apellido;
            document.getElementById('cliente-telefono').value = cliente.telefono;
            document.getElementById('cliente-calle').value = cliente.calle || '';
            document.getElementById('cliente-numero').value = cliente.numero || '';
            document.getElementById('cliente-piso').value = cliente.piso || '';
            document.getElementById('cliente-departamento').value = cliente.departamento || '';
            document.getElementById('cliente-email').value = cliente.email || '';
            document.getElementById('cliente-localidad').value = cliente.localidad || '';
            document.getElementById('cliente-codigo-postal').value = cliente.codigoPostal || '';
        }

        function eliminarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (!cliente) return;
            
            // Verificar si tiene pedidos
            const nombreCompleto = `${cliente.nombre} ${cliente.apellido}`;
            const tienePedidos = pedidos.some(p => p.cliente === nombreCompleto);
            
            if (tienePedidos) {
                alert('No se puede eliminar este cliente porque tiene pedidos asociados.');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar este cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                localStorage.setItem('clientes', JSON.stringify(clientes));
                mostrarClientes();
                actualizarSelectClientes();
            }
        }

        function cancelarCliente() {
            limpiarFormularioCliente();
        }

        function limpiarFormularioCliente() {
            document.getElementById('cliente-form').reset();
            editandoCliente = null;
        }

        function actualizarSelectClientes() {
            const select = document.getElementById('pedido-cliente');
            select.innerHTML = '<option value="">Seleccionar cliente...</option>';
            
            // Ordenar clientes alfab√©ticamente por apellido
            const clientesOrdenados = [...clientes].sort((a, b) => {
                const apellidoA = a.apellido.toLowerCase();
                const apellidoB = b.apellido.toLowerCase();
                if (apellidoA !== apellidoB) {
                    return apellidoA.localeCompare(apellidoB);
                }
                return a.nombre.toLowerCase().localeCompare(b.nombre.toLowerCase());
            });
            
            clientesOrdenados.forEach(cliente => {
                const nombreCompleto = `${cliente.nombre} ${cliente.apellido}`;
                select.innerHTML += `<option value="${nombreCompleto}">${nombreCompleto}</option>`;
            });
        }

        // FUNCIONES DE PEDIDOS
        function actualizarSelectProductos() {
            const select = document.getElementById('pedido-productos');
            select.innerHTML = '<option value="">Seleccionar producto...</option>';
            
            const productosOrdenados = [...productos].sort((a, b) => a.nombre.localeCompare(b.nombre));
            
            productosOrdenados.forEach(producto => {
                select.innerHTML += `<option value="${producto.id}">${producto.nombre} - ${producto.precio.toFixed(2)}</option>`;
            });
        }

        function agregarProductoPedido() {
            const select = document.getElementById('pedido-productos');
            const productoId = parseInt(select.value);
            
            if (!productoId) return;
            
            const producto = productos.find(p => p.id === productoId);
            if (!producto) return;
            
            // Verificar si ya est√° agregado
            const existe = productosPedidoTemp.find(p => p.id === productoId);
            if (existe) {
                existe.cantidad++;
            } else {
                productosPedidoTemp.push({
                    id: productoId,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: 1
                });
            }
            
            mostrarProductosPedido();
            select.value = '';
        }

        function mostrarProductosPedido() {
            const container = document.getElementById('productos-pedido');
            
            if (productosPedidoTemp.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; font-style: italic;">No hay productos en el pedido</p>';
                document.getElementById('total-pedido').textContent = '0.00';
                return;
            }
            
            let total = 0;
            container.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>Productos del Pedido:</h4>
                    ${productosPedidoTemp.map((item, index) => {
                        const subtotal = item.precio * item.cantidad;
                        total += subtotal;
                        return `
                            <div class="component-item">
                                <span>${item.cantidad}x ${item.nombre} - ${item.precio.toFixed(2)} c/u</span>
                                <div>
                                    <span style="font-weight: 600;">${subtotal.toFixed(2)}</span>
                                    <button type="button" class="btn btn-danger btn-small" onclick="eliminarProductoPedido(${index})" style="margin-left: 10px;">‚ùå</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            document.getElementById('total-pedido').textContent = total.toFixed(2);
        }

        function eliminarProductoPedido(index) {
            productosPedidoTemp.splice(index, 1);
            mostrarProductosPedido();
        }

        document.getElementById('pedido-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cliente = document.getElementById('pedido-cliente').value;
            const fecha = document.getElementById('pedido-fecha').value;
            const hora = document.getElementById('pedido-hora').value;
            const notas = document.getElementById('pedido-notas').value.trim();
            
            if (!cliente || !fecha || !hora) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (productosPedidoTemp.length === 0) {
                alert('Debes agregar al menos un producto al pedido');
                return;
            }
            
            const total = productosPedidoTemp.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            
            const pedido = {
                id: editandoPedido ? editandoPedido.id : Date.now(),
                cliente,
                fecha,
                hora,
                productos: [...productosPedidoTemp],
                total,
                notas,
                estado: 'En curso',
                fechaCreacion: new Date().toISOString().split('T')[0]
            };
            
            if (editandoPedido) {
                const index = pedidos.findIndex(p => p.id === editandoPedido.id);
                pedidos[index] = pedido;
                editandoPedido = null;
            } else {
                pedidos.push(pedido);
            }
            
            localStorage.setItem('pedidos', JSON.stringify(pedidos));
            mostrarPedidos();
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            limpiarFormularioPedido();
        });

        function mostrarPedidos() {
            const lista = document.getElementById('pedidos-lista');
            
            if (pedidos.length === 0) {
                lista.innerHTML = '<div class="no-items">No hay pedidos registrados</div>';
                return;
            }
            
            // Ordenar pedidos por fecha de entrega
            const pedidosOrdenados = [...pedidos].sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            
            lista.innerHTML = pedidosOrdenados.map(pedido => {
                const estadoPago = calcularEstadoPago(pedido.id);
                const totalPagado = calcularTotalPagado(pedido.id);
                const saldoPendiente = pedido.total - totalPagado;
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="item-title">
                                ${pedido.cliente} - ${new Date(pedido.fecha).toLocaleDateString()}
                                <span class="badge ${pedido.estado === 'Entregado' ? 'badge-success' : 'badge-warning'}">
                                    ${pedido.estado}
                                </span>
                            </div>
                            <div class="item-actions">
                                ${pedido.estado === 'En curso' ? `
                                    <button class="btn btn-success btn-small" onclick="marcarEntregado(${pedido.id})">‚úì Entregar</button>
                                ` : ''}
                                <button class="btn btn-primary btn-small" onclick="registrarPagoRapido(${pedido.id})">üí∞ Pago</button>
                                <button class="btn btn-warning btn-small" onclick="editarPedido(${pedido.id})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger btn-small" onclick="eliminarPedido(${pedido.id})">üóëÔ∏è Eliminar</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <strong>Total:</strong> ${pedido.total.toFixed(2)} | 
                            <strong>Productos:</strong> ${pedido.productos.length}
                            ${pedido.notas ? ` | <strong>Notas:</strong> ${pedido.notas}` : ''}
                        </div>
                        <div class="payment-info">
                            <div class="payment-status">
                                <span class="badge ${estadoPago === 'Pagado' ? 'badge-success' : estadoPago === 'Parcial' ? 'badge-warning' : 'badge-danger'}">
                                    ${estadoPago}
                                </span>
                            </div>
                            <div class="payment-amount">
                                Pagado: <span class="paid-amount">${totalPagado.toFixed(2)}</span>
                                ${saldoPendiente > 0 ? ` | Pendiente: <span class="debt-amount">${saldoPendiente.toFixed(2)}</span>` : ''}
                            </div>
                        </div>
                        <div class="item-components">
                            <strong>Productos:</strong>
                            ${pedido.productos.map(prod => `
                                <div class="component-item">
                                    <span>${prod.cantidad}x ${prod.nombre}</span>
                                    <span>${(prod.precio * prod.cantidad).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function marcarEntregado(id) {
            if (confirm('¬øMarcar este pedido como entregado?')) {
                const index = pedidos.findIndex(p => p.id === id);
                if (index !== -1) {
                    pedidos[index].estado = 'Entregado';
                    localStorage.setItem('pedidos', JSON.stringify(pedidos));
                    mostrarPedidos();
                }
            }
        }

        function registrarPagoRapido(pedidoId) {
            // Cambiar a tab de pagos y preseleccionar el pedido
            showTab('pagos');
            document.querySelector('.tab[onclick="showTab(\'pagos\')"]').click();
            
            setTimeout(() => {
                document.getElementById('pago-pedido').value = pedidoId;
                actualizarInfoPago();
            }, 100);
        }

        function editarPedido(id) {
            const pedido = pedidos.find(p => p.id === id);
            if (!pedido) return;
            
            editandoPedido = pedido;
            productosPedidoTemp = [...pedido.productos];
            
            document.getElementById('pedido-cliente').value = pedido.cliente;
            document.getElementById('pedido-fecha').value = pedido.fecha;
            document.getElementById('pedido-hora').value = pedido.hora || '';
            document.getElementById('pedido-notas').value = pedido.notas || '';
            
            mostrarProductosPedido();
        }

        function eliminarPedido(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este pedido? Tambi√©n se eliminar√°n todos los pagos asociados.')) {
                pedidos = pedidos.filter(p => p.id !== id);
                pagos = pagos.filter(p => p.pedidoId !== id);
                localStorage.setItem('pedidos', JSON.stringify(pedidos));
                localStorage.setItem('pagos', JSON.stringify(pagos));
                mostrarPedidos();
                mostrarPagos();
                actualizarSelectPedidos();
                actualizarEstadisticasPagos();
            }
        }

        function cancelarPedido() {
            limpiarFormularioPedido();
        }

        function limpiarFormularioPedido() {
            document.getElementById('pedido-form').reset();
            editandoPedido = null;
            productosPedidoTemp = [];
            mostrarProductosPedido();
        }

        // FUNCIONES DE PAGOS
        function actualizarSelectPedidos() {
            const select = document.getElementById('pago-pedido');
            select.innerHTML = '<option value="">Seleccionar pedido...</option>';
            
            // Solo mostrar pedidos que no est√©n completamente pagados
            const pedidosConSaldo = pedidos.filter(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                return totalPagado < pedido.total;
            });
            
            pedidosConSaldo.forEach(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                const saldo = pedido.total - totalPagado;
                select.innerHTML += `
                    <option value="${pedido.id}">
                        ${pedido.cliente} - ${new Date(pedido.fecha).toLocaleDateString()} 
                        (Saldo: ${saldo.toFixed(2)})
                    </option>
                `;
            });
        }

        function actualizarInfoPago() {
            const pedidoId = parseInt(document.getElementById('pago-pedido').value);
            const infoDiv = document.getElementById('info-pago');
            
            if (!pedidoId) {
                infoDiv.style.display = 'none';
                return;
            }
            
            const pedido = pedidos.find(p => p.id === pedidoId);
            if (!pedido) return;
            
            const totalPagado = calcularTotalPagado(pedidoId);
            const saldoPendiente = pedido.total - totalPagado;
            const pagosPrevios = pagos.filter(p => p.pedidoId === pedidoId);
            
            // Sugerir el saldo completo como monto
            document.getElementById('pago-monto').value = saldoPendiente.toFixed(2);
            
            infoDiv.innerHTML = `
                <h4>Informaci√≥n del Pedido</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <strong>Cliente:</strong> ${pedido.cliente}<br>
                        <strong>Fecha entrega:</strong> ${new Date(pedido.fecha).toLocaleDateString()}<br>
                        <strong>Total pedido:</strong> ${pedido.total.toFixed(2)}
                    </div>
                    <div>
                        <strong>Ya pagado:</strong> <span class="paid-amount">${totalPagado.toFixed(2)}</span><br>
                        <strong>Saldo pendiente:</strong> <span class="debt-amount">${saldoPendiente.toFixed(2)}</span><br>
                        <strong>Pagos realizados:</strong> ${pagosPrevios.length}
                    </div>
                </div>
                ${pagosPrevios.length > 0 ? `
                    <div style="margin-top: 15px;">
                        <strong>Historial de pagos:</strong>
                        ${pagosPrevios.map(pago => `
                            <div style="background: #e9ecef; padding: 8px; border-radius: 4px; margin: 5px 0;">
                                ${new Date(pago.fecha).toLocaleDateString()} - ${pago.monto.toFixed(2)} (${pago.metodo})
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            infoDiv.style.display = 'block';
        }

        document.getElementById('pago-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const pedidoId = parseInt(document.getElementById('pago-pedido').value);
            const monto = parseFloat(document.getElementById('pago-monto').value);
            const metodo = document.getElementById('pago-metodo').value;
            const fecha = document.getElementById('pago-fecha').value;
            const notas = document.getElementById('pago-notas').value.trim();
            
            if (!pedidoId || !monto || !metodo || !fecha) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (monto <= 0) {
                alert('El monto debe ser mayor a 0');
                return;
            }
            
            const pedido = pedidos.find(p => p.id === pedidoId);
            const totalPagado = calcularTotalPagado(pedidoId);
            const saldoPendiente = pedido.total - totalPagado;
            
            if (monto > saldoPendiente) {
                if (!confirm(`El monto (${monto.toFixed(2)}) es mayor al saldo pendiente (${saldoPendiente.toFixed(2)}). ¬øContinuar?`)) {
                    return;
                }
            }
            
            const pago = {
                id: Date.now(),
                pedidoId,
                monto,
                metodo,
                fecha,
                notas,
                fechaRegistro: new Date().toISOString()
            };
            
            pagos.push(pago);
            localStorage.setItem('pagos', JSON.stringify(pagos));
            
            mostrarPagos();
            mostrarPedidos();
            actualizarSelectPedidos();
            actualizarEstadisticasPagos();
            limpiarFormularioPago();
            
            alert('Pago registrado exitosamente');
        });

        function mostrarPagos() {
            const lista = document.getElementById('pagos-lista');
            const saldosTabla = document.getElementById('saldos-pendientes');
            
            // Mostrar historial de pagos
            if (pagos.length === 0) {
                lista.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #6c757d; font-style: italic;">No hay pagos registrados</td></tr>';
            } else {
                const pagosOrdenados = [...pagos].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                
                lista.innerHTML = pagosOrdenados.map(pago => {
                    const pedido = pedidos.find(p => p.id === pago.pedidoId);
                    const estadoPago = calcularEstadoPago(pago.pedidoId);
                    
                    return `
                        <tr>
                            <td>${new Date(pago.fecha).toLocaleDateString()}</td>
                            <td>${pedido ? pedido.cliente : 'Cliente eliminado'}</td>
                            <td>${pedido ? new Date(pedido.fecha).toLocaleDateString() : '-'}</td>
                            <td class="paid-amount">${pago.monto.toFixed(2)}</td>
                            <td>${pago.metodo}</td>
                            <td>
                                <span class="badge ${estadoPago === 'Pagado' ? 'badge-success' : estadoPago === 'Parcial' ? 'badge-warning' : 'badge-danger'}">
                                    ${estadoPago}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-danger btn-small" onclick="eliminarPago(${pago.id})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Mostrar saldos pendientes
            const pedidosConSaldo = pedidos.filter(pedido => {
                const totalPagado = calcularTotalPagado(pedido.id);
                return totalPagado < pedido.total;
            });
            
            if (pedidosConSaldo.length === 0) {
                saldosTabla.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #28a745; font-weight: 600;">¬°Todos los pedidos est√°n pagados!</td></tr>';
            } else {
                saldosTabla.innerHTML = pedidosConSaldo.map(pedido => {
                    const totalPagado = calcularTotalPagado(pedido.id);
                    const saldo = pedido.total - totalPagado;
                    
                    return `
                        <tr>
                            <td>${pedido.cliente}</td>
                            <td>${new Date(pedido.fecha).toLocaleDateString()}</td>
                            <td>${pedido.total.toFixed(2)}</td>
                            <td class="paid-amount">${totalPagado.toFixed(2)}</td>
                            <td class="debt-amount">${saldo.toFixed(2)}</td>
                            <td>${new Date(pedido.fecha).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-primary btn-small" onclick="registrarPagoRapido(${pedido.id})">üí∞ Pagar</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function eliminarPago(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este pago?')) {
                pagos = pagos.filter(p => p.id !== id);
                localStorage.setItem('pagos', JSON.stringify(pagos));
                mostrarPagos();
                mostrarPedidos();
                actualizarSelectPedidos();
                actualizarEstadisticasPagos();
            }
        }

        function cancelarPago() {
            limpiarFormularioPago();
        }

        function limpiarFormularioPago() {
            document.getElementById('pago-form').reset();
            document.getElementById('info-pago').style.display = 'none';
            document.getElementById('pago-fecha').value = new Date().toISOString().split('T')[0];
        }

        // FUNCIONES DE C√ÅLCULO
        function calcularTotalPagado(pedidoId) {
            return pagos
                .filter(pago => pago.pedidoId === pedidoId)
                .reduce((total, pago) => total + pago.monto, 0);
        }

        function calcularEstadoPago(pedidoId) {
            const pedido = pedidos.find(p => p.id === pedidoId);
            if (!pedido) return 'Desconocido';
            
            const totalPagado = calcularTotalPagado(pedidoId);
            
            if (totalPagado === 0) return 'Pendiente';
            if (totalPagado >= pedido.total) return 'Pagado';
            return 'Parcial';
        }

        function actualizarEstadisticasPagos() {
            const totalPendiente = pedidos.reduce((total, pedido) => {
                const pagado = calcularTotalPagado(pedido.id);
                return total + Math.max(0, pedido.total - pagado);
            }, 0);
            
            const totalCobrado = pagos.reduce((total, pago) => total + pago.monto, 0);
            
            const pedidosImpagos = pedidos.filter(pedido => {
                const pagado = calcularTotalPagado(pedido.id);
                return pagado < pedido.total;
            }).length;
            
            document.getElementById('total-pendiente').textContent = `${totalPendiente.toFixed(0)}`;
            document.getElementById('total-cobrado').textContent = `${totalCobrado.toFixed(0)}`;
            document.getElementById('pedidos-impagos').textContent = pedidosImpagos;
        }
    </script>
</body>
</html>
